<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notifications | eXo developers documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="eXo documentation">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.aefff845.css" as="style"><link rel="preload" href="/assets/js/app.566fc5fe.js" as="script"><link rel="preload" href="/assets/js/2.a6004e7f.js" as="script"><link rel="preload" href="/assets/js/1.298b45b6.js" as="script"><link rel="preload" href="/assets/js/55.12746217.js" as="script"><link rel="prefetch" href="/assets/js/10.225b8ad6.js"><link rel="prefetch" href="/assets/js/11.fcfda894.js"><link rel="prefetch" href="/assets/js/12.8288d633.js"><link rel="prefetch" href="/assets/js/13.61c54a2f.js"><link rel="prefetch" href="/assets/js/14.c8220840.js"><link rel="prefetch" href="/assets/js/15.cf0e000a.js"><link rel="prefetch" href="/assets/js/16.12acf4f0.js"><link rel="prefetch" href="/assets/js/17.60e99e03.js"><link rel="prefetch" href="/assets/js/18.402065f0.js"><link rel="prefetch" href="/assets/js/19.4cde00c8.js"><link rel="prefetch" href="/assets/js/20.e735bd74.js"><link rel="prefetch" href="/assets/js/21.4d9631b7.js"><link rel="prefetch" href="/assets/js/22.38c3a0bb.js"><link rel="prefetch" href="/assets/js/23.96cba659.js"><link rel="prefetch" href="/assets/js/24.6a323bb6.js"><link rel="prefetch" href="/assets/js/25.d314e852.js"><link rel="prefetch" href="/assets/js/26.781556fb.js"><link rel="prefetch" href="/assets/js/27.db2034f7.js"><link rel="prefetch" href="/assets/js/28.bdd32a1a.js"><link rel="prefetch" href="/assets/js/29.7705a494.js"><link rel="prefetch" href="/assets/js/3.535cbfb5.js"><link rel="prefetch" href="/assets/js/30.5235d8d8.js"><link rel="prefetch" href="/assets/js/31.12dc91a0.js"><link rel="prefetch" href="/assets/js/32.7b9193b7.js"><link rel="prefetch" href="/assets/js/33.d786c476.js"><link rel="prefetch" href="/assets/js/34.82a8e2bb.js"><link rel="prefetch" href="/assets/js/35.bfed5ce5.js"><link rel="prefetch" href="/assets/js/36.08aae2f6.js"><link rel="prefetch" href="/assets/js/37.7c5839ea.js"><link rel="prefetch" href="/assets/js/38.5a9c6f81.js"><link rel="prefetch" href="/assets/js/39.64b36a7a.js"><link rel="prefetch" href="/assets/js/4.36aa3fdb.js"><link rel="prefetch" href="/assets/js/40.91490da1.js"><link rel="prefetch" href="/assets/js/41.1bb028a9.js"><link rel="prefetch" href="/assets/js/42.2b2e6226.js"><link rel="prefetch" href="/assets/js/43.3eb1d2ff.js"><link rel="prefetch" href="/assets/js/44.aff75618.js"><link rel="prefetch" href="/assets/js/45.ae4c3883.js"><link rel="prefetch" href="/assets/js/46.c22a02ed.js"><link rel="prefetch" href="/assets/js/47.c2a86641.js"><link rel="prefetch" href="/assets/js/48.49f8e4ff.js"><link rel="prefetch" href="/assets/js/49.ef6e633d.js"><link rel="prefetch" href="/assets/js/5.8d70814d.js"><link rel="prefetch" href="/assets/js/50.82b2cb38.js"><link rel="prefetch" href="/assets/js/51.26af3c19.js"><link rel="prefetch" href="/assets/js/52.f2d45ccb.js"><link rel="prefetch" href="/assets/js/53.ecd43fd3.js"><link rel="prefetch" href="/assets/js/54.17169cc4.js"><link rel="prefetch" href="/assets/js/56.77bdaee4.js"><link rel="prefetch" href="/assets/js/57.0b269ef5.js"><link rel="prefetch" href="/assets/js/58.f7328ad9.js"><link rel="prefetch" href="/assets/js/59.5a4f9f04.js"><link rel="prefetch" href="/assets/js/6.477d5345.js"><link rel="prefetch" href="/assets/js/60.30d9251f.js"><link rel="prefetch" href="/assets/js/61.8b948aa3.js"><link rel="prefetch" href="/assets/js/62.5a0f0c07.js"><link rel="prefetch" href="/assets/js/63.e454eff4.js"><link rel="prefetch" href="/assets/js/64.a49d269e.js"><link rel="prefetch" href="/assets/js/65.bfc4b138.js"><link rel="prefetch" href="/assets/js/66.25150fb5.js"><link rel="prefetch" href="/assets/js/67.f5cc4cec.js"><link rel="prefetch" href="/assets/js/68.765560e5.js"><link rel="prefetch" href="/assets/js/69.1b311bba.js"><link rel="prefetch" href="/assets/js/7.75df615e.js"><link rel="prefetch" href="/assets/js/70.1d2c355e.js"><link rel="prefetch" href="/assets/js/71.764ddbf9.js"><link rel="prefetch" href="/assets/js/72.45bf8487.js"><link rel="prefetch" href="/assets/js/73.5834c41d.js"><link rel="prefetch" href="/assets/js/74.981741a8.js"><link rel="prefetch" href="/assets/js/75.60c0af0f.js"><link rel="prefetch" href="/assets/js/76.44b7b182.js"><link rel="prefetch" href="/assets/js/77.d4e20165.js"><link rel="prefetch" href="/assets/js/78.c33db6b5.js"><link rel="prefetch" href="/assets/js/79.c55e2cf6.js"><link rel="prefetch" href="/assets/js/80.3da0ce0e.js"><link rel="prefetch" href="/assets/js/81.09e71458.js"><link rel="prefetch" href="/assets/js/82.d36b7bb4.js"><link rel="prefetch" href="/assets/js/83.102fdcea.js"><link rel="prefetch" href="/assets/js/84.8a64b178.js"><link rel="prefetch" href="/assets/js/85.fed6c251.js"><link rel="prefetch" href="/assets/js/86.70751800.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f3569c9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aefff845.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">eXo developers documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/getting-started/Introduction.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/administration/" class="nav-link">
  Technical Administration
</a></div><div class="nav-item"><a href="/guide/developer-guide/rest-api.html" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="https://github.com/exoplatform/exo-community/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Q&amp;A
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/getting-started/Introduction.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/administration/" class="nav-link">
  Technical Administration
</a></div><div class="nav-item"><a href="/guide/developer-guide/rest-api.html" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="https://github.com/exoplatform/exo-community/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Q&amp;A
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/guide/getting-started/Introduction.html" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/getting-started/Introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/guide/getting-started/start-community.html" class="sidebar-link">Start eXo community</a></li></ul></section></li><li><a href="/guide/userAndAdminGuide.html" class="sidebar-link">User and Administrator guides</a></li><li><section class="sidebar-group depth-0"><a href="/guide/developer-guide/getting-started" class="sidebar-heading clickable open"><span>Developer guide</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/developer-guide/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/developer-guide/prepare-extension-project.html" class="sidebar-link">First step : Prepare extension project</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/guide/developer-guide/simple-integration/" class="sidebar-heading clickable router-link-active open"><span>Simple Integration</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/developer-guide/simple-integration/activity-type.html" class="sidebar-link">Activity types</a></li><li><a href="/guide/developer-guide/simple-integration/event-listeners.html" class="sidebar-link">Event listeners</a></li><li><a href="/guide/developer-guide/simple-integration/notification.html" aria-current="page" class="active sidebar-link">Notifications</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/developer-guide/simple-integration/notification.html#extending-notification-system" class="sidebar-link">Extending notification system</a></li><li class="sidebar-sub-header"><a href="/guide/developer-guide/simple-integration/notification.html#overriding-email-notification-templates" class="sidebar-link">Overriding email notification templates</a></li></ul></li><li><a href="/guide/developer-guide/simple-integration/scheduled-jobs.html" class="sidebar-link">Scheduled jobs</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/guide/developer-guide/intermediate-integration/" class="sidebar-heading clickable"><span>Intermediate Integration</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/guide/developer-guide/rest-api" class="sidebar-heading clickable"><span>REST API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/guide/developer-guide/miscellaneous/debug-dev-mode" class="sidebar-heading clickable"><span>Miscellaneous</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/guide/product-reference/" class="sidebar-heading clickable"><span>Product reference</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/product-reference/Internationalization.html" class="sidebar-link">Internationalization configuration</a></li><li><a href="/guide/product-reference/Javascript.html" class="sidebar-link">Developing JavaScript</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="notifications"><a href="#notifications" class="header-anchor">#</a> Notifications</h1> <blockquote><p>🚧 Work in progress</p> <p>This page will describe how to create a new notification type in eXo Platorm</p></blockquote> <ul><li><p>Extending notification system : Steps to create an extension which plugs a new notification type into current notification system of eXo Platform.</p></li> <li><p>Overriding email notification : Steps to create an extension which overrides the email notification templates following your own style.</p></li></ul> <h2 id="extending-notification-system"><a href="#extending-notification-system" class="header-anchor">#</a> Extending notification system</h2> <p>eXo Platform provides you with a notification system that allows you to extend in 2 mechanisms:</p> <ul><li>The extensibility of notification channels : add/remove channels such as email, on-site or through mobile push systems.</li> <li>The extensibility of notification types : add/remove notification types linked to system events or user actions such as connection invitation, posting some space activities, uploading documents or sharing contents etc ...</li></ul> <p>This section will walk you through a <a href="https://github.com/exo-samples/docs-samples/tree/master/sample-notification" target="_blank" rel="noopener noreferrer">complete sample extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that instructs you how to:</p> <ol><li>Create a new notification that pushes notification information following an event or acion on the server.</li> <li>Override existing notification templates</li></ol> <h3 id="how-to-develop-the-new-notification-type"><a href="#how-to-develop-the-new-notification-type" class="header-anchor">#</a> How to develop the new notification type</h3> <p>First you need to create a new Maven project with the overall structure:</p> <div class="language- extra-class"><pre class="language-text"><code>📦sample-notification
 ┣ 📂services
 ┃ ┣ 📂src
 ┃ ┃ ┗ 📂main
 ┃ ┃ ┃ ┗ 📂java
 ┃ ┃ ┃ ┃ ┗ 📂org
 ┃ ┃ ┃ ┃ ┃ ┗ 📂exoplatform
 ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📂samples
 ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📂notification
 ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┣ 📂plugin
 ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📜UpdateProfilePlugin.java
 ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📜SocialProfileListener.java
 ┃ ┗ 📜pom.xml
 ┣ 📂webapp
 ┃ ┣ 📂src
 ┃ ┃ ┗ 📂main
 ┃ ┃ ┃ ┣ 📂resources
 ┃ ┃ ┃ ┃ ┗ 📂locale
 ┃ ┃ ┃ ┃ ┃ ┗ 📂notification
 ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📂template
 ┃ ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📜Notification_en.properties
 ┃ ┃ ┃ ┗ 📂webapp
 ┃ ┃ ┃ ┃ ┣ 📂META-INF
 ┃ ┃ ┃ ┃ ┃ ┗ 📂exo-conf
 ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📜configuration.xml
 ┃ ┃ ┃ ┃ ┗ 📂WEB-INF
 ┃ ┃ ┃ ┃ ┃ ┣ 📂conf
 ┃ ┃ ┃ ┃ ┃ ┃ ┗ 📜configuration.xml
 ┃ ┃ ┃ ┃ ┃ ┗ 📜web.xml
 ┃ ┗ 📜pom.xml
 ┗ 📜pom.xml
</code></pre></div><p>The new project <strong>sample-notification</strong> is composed of two modules.</p> <h4 id="services-module-business-logic-module"><a href="#services-module-business-logic-module" class="header-anchor">#</a> Services module : business logic module</h4> <p>when built, this module will generate a jar file that will be deployed in the <strong>lib</strong> folder of eXo platform server. In the current tutorial, this module will contain two classes :</p> <ol><li><strong>SocialProfileListener.java</strong> : this is an event listener that will be executed when a user updates his profile information.</li></ol> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification</span><span class="token punctuation">;</span>

 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span></span><span class="token class-name">NotificationContext</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PluginKey</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">NotificationContextImpl</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>identity<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Profile</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>profile<span class="token punctuation">.</span></span><span class="token class-name">ProfileLifeCycleEvent</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>profile<span class="token punctuation">.</span></span><span class="token class-name">ProfileListenerPlugin</span></span><span class="token punctuation">;</span>

 <span class="token comment">/**
 *  This class extends ProfileListenerPlugin to trigger avatar/experience updating events
 *  and plug them into UpdateProfilePlugin as notifications
 */</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocialProfileListener</span> <span class="token keyword">extends</span> <span class="token class-name">ProfileListenerPlugin</span> <span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">avatarUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bannerUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">experienceSectionUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contactSectionUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createProfile</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aboutMeUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">basicInfoUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">headerSectionUpdated</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">sendNotification</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token class-name">ProfileLifeCycleEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// Load user profile</span>
     <span class="token class-name">Profile</span> profile <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// Create the notification context and append the profile object</span>
     <span class="token class-name">NotificationContext</span> ctx <span class="token operator">=</span> <span class="token class-name">NotificationContextImpl</span><span class="token punctuation">.</span><span class="token function">cloneInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">PROFILE</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// Call notification executor that will load the notification type configuration and create a new notification to be sent to concerned users</span>
     ctx<span class="token punctuation">.</span><span class="token function">getNotificationExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">makeCommand</span><span class="token punctuation">(</span><span class="token class-name">PluginKey</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li><strong>UpdateProfilePlugin.java</strong> : this is a Notification System plugin that will create a new notification and store it in database before it will be sent to concerned users.</li></ol> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin</span><span class="token punctuation">;</span>

 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span></span><span class="token class-name">NotificationContext</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ArgumentLiteral</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">NotificationInfo</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">BaseNotificationPlugin</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">CommonsUtils</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">ListAccess</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>container<span class="token punctuation">.</span>xml<span class="token punctuation">.</span></span><span class="token class-name">InitParams</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>services<span class="token punctuation">.</span>log<span class="token punctuation">.</span></span><span class="token class-name">ExoLogger</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>services<span class="token punctuation">.</span>log<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>identity<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Identity</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>identity<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Profile</span></span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>social<span class="token punctuation">.</span>core<span class="token punctuation">.</span>manager<span class="token punctuation">.</span></span><span class="token class-name">RelationshipManager</span></span><span class="token punctuation">;</span>

 <span class="token comment">/**
 * This class extends BaseNotificationPlugin to push new notification type of
 * profile updating event
 */</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateProfilePlugin</span> <span class="token keyword">extends</span> <span class="token class-name">BaseNotificationPlugin</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">ArgumentLiteral</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span><span class="token punctuation">&gt;</span></span> <span class="token constant">PROFILE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArgumentLiteral</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Profile</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;profile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Log</span>                     <span class="token constant">LOG</span>     <span class="token operator">=</span> <span class="token class-name">ExoLogger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span>                   <span class="token constant">ID</span>      <span class="token operator">=</span> <span class="token string">&quot;UpdateProfilePlugin&quot;</span><span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">(</span><span class="token class-name">InitParams</span> initParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">super</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token constant">ID</span><span class="token punctuation">;</span> <span class="token comment">// return the Identifier of the notification plugin</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// this function could be used to decide if a notification is valid to be sent</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">protected</span> <span class="token class-name">NotificationInfo</span> <span class="token function">makeNotification</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// Load the user profile from the notification context</span>
     <span class="token class-name">Profile</span> profile <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token constant">PROFILE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// Load the list of contacts that are connected to the current user who updated his profile,</span>
     <span class="token comment">// all of them should receive the notification</span>
     <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> receivers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">RelationshipManager</span> relationshipManager <span class="token operator">=</span> <span class="token class-name">CommonsUtils</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token class-name">RelationshipManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">Identity</span> updatedIdentity <span class="token operator">=</span> profile<span class="token punctuation">.</span><span class="token function">getIdentity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">ListAccess</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Identity</span><span class="token punctuation">&gt;</span></span> listAccess <span class="token operator">=</span> relationshipManager<span class="token punctuation">.</span><span class="token function">getConnections</span><span class="token punctuation">(</span>updatedIdentity<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token class-name">Identity</span><span class="token punctuation">[</span><span class="token punctuation">]</span> relationships <span class="token operator">=</span> relationshipManager<span class="token punctuation">.</span><span class="token function">getConnections</span><span class="token punctuation">(</span>updatedIdentity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> listAccess<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Identity</span> i <span class="token operator">:</span> relationships<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         receivers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">getRemoteId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token constant">LOG</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>

     <span class="token comment">//Create the notification item object that will be added to the queue of notification to be sent</span>
     <span class="token keyword">return</span> <span class="token class-name">NotificationInfo</span><span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span>updatedIdentity<span class="token punctuation">.</span><span class="token function">getRemoteId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>receivers<span class="token punctuation">)</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>updatedIdentity<span class="token punctuation">.</span><span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; updated his/her profile.&lt;br/&gt;&quot;</span><span class="token punctuation">)</span>
                           <span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

</code></pre></div><ol start="3"><li><strong>pom.xml</strong> : the maven descriptor of the services module is simple and does just create a new jar file when the module is built</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
           <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>notification<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.x-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sample-notification-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.exoplatform.social<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>social-component-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.exoplatform.social<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>social-component-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>sample-notification-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="webapp-the-extension-module"><a href="#webapp-the-extension-module" class="header-anchor">#</a> Webapp : the extension module</h4> <p>This module is similar to the extension built in the tutorial of <a href="/guide/developer-guide/prepare-extension-project">Prepare extension project</a>. Inside this extension we will add the configuration that will activate the new notification type.
Inside the file <strong>webapp/src/main/webapp/WEB-INF/conf/configuration.xml</strong> we will add the following configuration :</p> <div class="language-xml extra-class"><pre class="language-xml"><code>  <span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.exoplatform.org/xml/ns/kernel_1_2.xsd http://www.exoplatform.org/xml/ns/kernel_1_2.xsd<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.exoplatform.org/xml/ns/kernel_1_2.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- register new event listener that will be fired when a user updates his profile--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target-component</span><span class="token punctuation">&gt;</span></span>org.exoplatform.social.core.manager.IdentityManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target-component</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>SocialProfileListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-method</span><span class="token punctuation">&gt;</span></span>registerProfileListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-method</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples.notification.SocialProfileListener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- register new notification type --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target-component</span><span class="token punctuation">&gt;</span></span>org.exoplatform.commons.api.notification.service.setting.PluginContainer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target-component</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>notification.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-method</span><span class="token punctuation">&gt;</span></span>addPlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-method</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Add here the FQN of the new notification plugin --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples.notification.plugin.UpdateProfilePlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Initial information for plugin.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-params</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object-param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>template.UpdateProfilePlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The template of UpdateProfilePlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span>	<span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.exoplatform.commons.api.notification.plugin.config.PluginConfig<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

              <span class="token comment">&lt;!-- The ID of the plugin as it was declared in the class org.exoplatform.samples.notification.plugin.UpdateProfilePlugin --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pluginId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>this folder is  representating the extension : t

              <span class="token comment">&lt;!-- The label that will be displayed for this notification type in 'Manage Notifications' user settings page --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>resourceBundleKey<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>UINotification.label.UpdateProfilePlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>

              <span class="token comment">&lt;!-- Priority order of this plugin in the list of Notification plugins --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>

              <span class="token comment">&lt;!-- Default configuration of the sending frequency of this notification type for all users --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultConfig<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java.util.ArrayList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>Instantly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>collection</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
              
              <span class="token comment">&lt;!-- The group where the system will add this notification type in 'Manage Notifications' user settings page --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>groupId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>general<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
              
              <span class="token comment">&lt;!-- the path of the resource bundle file containing all the translated texts (dots . will be replaced by slashes / under the resources folder of the project) --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bundlePath<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>locale.notification.template.Notification<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-params</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3 id="deploy-and-test-the-notification-type"><a href="#deploy-and-test-the-notification-type" class="header-anchor">#</a> Deploy and test the notification type</h3> <ol><li>Under <strong>$EXO_HOME</strong> folder, create the folders lib and webapps if they do not exist</li> <li>Build Services and webapp modules, then copy it under <strong>$EXO_HOME/lib</strong> and <strong>$EXO_HOME/webapps</strong> respectively :</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> <span class="token variable">$EXO_HOME</span>/sources/sample-notification
mvn clean package
<span class="token function">cp</span> services/target/sample-notification-services.jar <span class="token variable">$EXO_HOME</span>/lib/
<span class="token function">cp</span> webapp/target/sample-notification-webapp.war <span class="token variable">$EXO_HOME</span>/webapps/
</code></pre></div><ol><li>Add both files to the docker-compose.yml file inside the <strong>volumes</strong> section. Both files will be mounted when the <strong>exo</strong> container is restarted, and they will be added to the lib and webapps folders of eXo server.</li></ol> <div class="language-yml extra-class"><pre class="language-yml"><code>       <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> exo_data<span class="token punctuation">:</span>/srv/exo
      <span class="token punctuation">-</span> exo_logs<span class="token punctuation">:</span>/var/log/exo
      <span class="token punctuation">-</span> $EXO_HOME/lib/sample<span class="token punctuation">-</span>notification<span class="token punctuation">-</span>services.jar<span class="token punctuation">:</span>/opt/exo/lib/sample<span class="token punctuation">-</span>notification<span class="token punctuation">-</span>services.jar
      <span class="token punctuation">-</span> $EXO_HOME/webapps/sample<span class="token punctuation">-</span>notification<span class="token punctuation">-</span>webapp.war<span class="token punctuation">:</span>/opt/exo/webapps/sample<span class="token punctuation">-</span>notification<span class="token punctuation">-</span>webapp.war
</code></pre></div><ol><li>Restart the eXo docker containers</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.yml up 
</code></pre></div><ol><li>To test the new notification type, follow the steps below :</li></ol> <ul><li>Create two users <strong>ali</strong> and <strong>john</strong></li> <li>Login with <strong>ali</strong> on first browser</li> <li>Login with <strong>john</strong> on another browser</li> <li><strong>ali</strong> sends an invitation to connect with <strong>john</strong>, the latter should accept it</li> <li><strong>ali</strong> updates his profile, bu editing his <em>About Me</em> or uploading anew avatar</li> <li><strong>john</strong> should receive an on-site notification and an email notification (if the server is correctly configured with an SMTP server)</li></ul> <div><figure><img src="/img/notification/mail-sample-notif.png" class="center"> <figcaption class="center-text">Mail received for the new notification</figcaption></figure> <figure><img src="/img/notification/web-sample-notif.png" class="center"> <figcaption class="center-text">On site notification</figcaption></figure></div> <h3 id="customize-the-look-feel-of-the-notification"><a href="#customize-the-look-feel-of-the-notification" class="header-anchor">#</a> Customize the Look &amp; Feel of the notification</h3> <p>As you noticed, the notification is very basic and shows the text with no formatting. To provide a better visual for the notification, you should add a templte provider.
The template provider is a class that will decorate the notification with a template written in Groovy language.
To provide a better looking for the Mail and On-site notifications, you will add some customization. Notification system requires a set of components to allow customizing how do notifications look like :
1- A groovy template : mix of HTML and groovy code to personalize how data is displayed.
2- A Message builder : a Java class that will process then inject notification data in template.
3- A Template provider : a java class that will associate each notification plugin with an associated notification builder, we will have a template provider per channel.</p> <h4 id="mail-notification"><a href="#mail-notification" class="header-anchor">#</a> Mail notification</h4> <p>To proceed with customizing the display of Mail notifications, you will need to :</p> <p>1- Add the template of the email notification. Create a new groovy template file named <strong>updateProfileMailNotification.gtmpl</strong> <em>sample-notification/webapp/src/main/webapp/WEB-INF/templates/notification/mail/updateProfileMailNotification.gtmpl</em></p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token operator">&lt;</span>table border<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;0&quot;</span></span> cellpadding<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;0&quot;</span></span> cellspacing<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;0&quot;</span></span> width<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;600&quot;</span></span> bgcolor<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;#ffffff&quot;</span></span> align<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;center&quot;</span></span>
       style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;background-color: #ffffff; font-size: 12px;color:#333333;line-height: 18px;font-family: HelveticaNeue, Helvetica, Arial, sans-serif;&quot;</span></span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> common header <span class="token keyword">for</span> all templates under eXo platform <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">%</span>
  _templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;header_title&quot;</span></span><span class="token punctuation">,</span> _ctx<span class="token punctuation">.</span><span class="token function">appRes</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;Notification.title.UpdateProfilePlugin&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  _ctx<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;war:/notification/templates/mail/NotificationHeader.gtmpl&quot;</span></span><span class="token punctuation">,</span> _templateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">%</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> end header <span class="token operator">--</span><span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>The main content of the email<span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>td bgcolor<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;#ffffff&quot;</span></span> style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;background-color: #ffffff;&quot;</span></span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>table cellpadding<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;0&quot;</span></span> cellspacing<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;0&quot;</span></span> width<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;100%&quot;</span></span> bgcolor<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;#ffffff&quot;</span></span>
             style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;background-color: #ffffff; border-left:1px solid #d8d8d8;border-right:1px solid #d8d8d8;&quot;</span></span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>td bgcolor<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;#ffffff&quot;</span></span> style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;background-color: #ffffff;&quot;</span></span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;text-align: center;vertical-align: middle; line-height: 100px;&quot;</span></span><span class="token operator">&gt;</span>
              <span class="token punctuation">$</span>USER_FULL_NAME updated his information<span class="token punctuation">,</span> you can check by visiting <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">USER_PROFILE_URL</span></span><span class="token string">&quot;</span></span><span class="token operator">&gt;</span>his
              profile<span class="token operator">&lt;</span><span class="token interpolation-string"><span class="token string">/a&gt;&lt;/</span></span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>end content area<span class="token operator">--</span><span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> common footer <span class="token keyword">for</span> all templates under eXo platform <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">%</span> _ctx<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;war:/notification/templates/mail/NotificationFooter.gtmpl&quot;</span></span><span class="token punctuation">,</span> _templateContext<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> end footer <span class="token operator">--</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
</code></pre></div><p>2- Add the template builder for the Mail notification, create a new java class named <strong>UpdateProfileMailNotificationBuilder.java</strong> under <em>sample-notification/src/main/java/org/exoplatform/samples/notification/mail</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>mail</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span></span><span class="token class-name">NotificationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">AbstractTemplateBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MessageInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">NotificationInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>service<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">CommonsUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Writer</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token static">USER_FULL_NAME</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token static">USER_PROFILE_URL</span></span><span class="token punctuation">;</span>

<span class="token comment">// All template builders should extend org.exoplatform.commons.api.notification.channel.template.AbstractTemplateBuilder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateProfileMailNotificationBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTemplateBuilder</span><span class="token punctuation">{</span>

  <span class="token comment">// each template bulder will override function makeMessage which returns a MessageInfo object that represents the sent notification</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token class-name">MessageInfo</span> <span class="token function">makeMessage</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// retrieve notification from the context</span>
    <span class="token class-name">NotificationInfo</span> notification <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getNotificationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Detect the language of the receiver</span>
    <span class="token class-name">String</span> language <span class="token operator">=</span> <span class="token function">getLanguage</span><span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a templateContext for the Mail notification</span>
    <span class="token class-name">TemplateContext</span> templateContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateContext</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> language<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Fill it with data, we should put all the variables with their values that will be replaced later in the notification template</span>
    <span class="token comment">// they will be prefixed with the $ symbol inside the template</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;USER_FULL_NAME&quot;</span><span class="token punctuation">,</span> notification<span class="token punctuation">.</span><span class="token function">getValueOwnerParameter</span><span class="token punctuation">(</span><span class="token constant">USER_FULL_NAME</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;USER_PROFILE_URL&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CommonsUtils</span><span class="token punctuation">.</span><span class="token function">getCurrentDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> notification<span class="token punctuation">.</span><span class="token function">getValueOwnerParameter</span><span class="token punctuation">(</span><span class="token constant">USER_PROFILE_URL</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// compute the mail subject</span>
    <span class="token class-name">String</span> subject <span class="token operator">=</span> <span class="token class-name">TemplateUtils</span><span class="token punctuation">.</span><span class="token function">processSubject</span><span class="token punctuation">(</span>templateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// compute the mail body</span>
    <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">TemplateUtils</span><span class="token punctuation">.</span><span class="token function">processGroovy</span><span class="token punctuation">(</span>templateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//binding the exception in case it was thrown by processing template</span>
    ctx<span class="token punctuation">.</span><span class="token function">setException</span><span class="token punctuation">(</span>templateContext<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create and return the MessageInfo object</span>
    <span class="token class-name">MessageInfo</span> messageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> messageInfo<span class="token punctuation">.</span><span class="token function">subject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">makeDigest</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> notificationContext<span class="token punctuation">,</span> <span class="token class-name">Writer</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This plugin does not generate a Digest email (daily/weekly)</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3- Add the template provider for Mail notifications, create a new java class named <strong>MailNotificationProvider.java</strong> under <em>sample-notification/src/main/java/org/exoplatform/samples/notification/mail</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>mail</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TemplateConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TemplateConfigs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PluginKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>container<span class="token punctuation">.</span>xml<span class="token punctuation">.</span></span><span class="token class-name">InitParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span></span><span class="token punctuation">;</span>

<span class="token comment">// Add the URL to load the template used by the notification plugin</span>
<span class="token annotation punctuation">@TemplateConfigs</span><span class="token punctuation">(</span>templates <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@TemplateConfig</span><span class="token punctuation">(</span>pluginId <span class="token operator">=</span> <span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">,</span> template <span class="token operator">=</span> <span class="token string">&quot;war:/templates/notification/mail/updateProfileMailNotification.gtmpl&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// All template providers should extend org.exoplatform.commons.api.notification.channel.template.TemplateProvider class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailNotificationProvider</span> <span class="token keyword">extends</span> <span class="token class-name">TemplateProvider</span> <span class="token punctuation">{</span>

  <span class="token comment">//constructor where we add the builder of mail notification to the list of templateBuilders inside the server</span>
  <span class="token keyword">public</span> <span class="token class-name">MailNotificationProvider</span><span class="token punctuation">(</span><span class="token class-name">InitParams</span> initParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>templateBuilders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">PluginKey</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateProfileMailNotificationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4- Update the configuration by telling the Channel manager to use the new Mail template provider for all email notifications related to the UpdateProfilePlugin. You need to add the following configuration in the file <strong>sample-notification/webapp/src/main/webapp/WEB-INF/conf/configuration.xml</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token comment">&lt;!-- template channel register --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Target service to update--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target-component</span><span class="token punctuation">&gt;</span></span>org.exoplatform.commons.api.notification.channel.ChannelManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target-component</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-plugin</span> <span class="token attr-name">profiles</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>all<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- unique name of our new plugin --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mail.channel.updateProfile.template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-method</span><span class="token punctuation">&gt;</span></span>registerTemplateProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-method</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- The new Template provider that we have just added --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples.notification.mail.MailNotificationProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-params</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- Target notification channel --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value-param</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>channel-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>MAIL_CHANNEL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value-param</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-params</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="web-notification"><a href="#web-notification" class="header-anchor">#</a> Web notification</h4> <p>The same steps are needed for customizing the on-site notification.</p> <p>1- Add the template of the email notification. Create a new groovy template file named <strong>updateProfileWebNotification.gtmpl</strong> under the folder <em>sample-notification/webapp/src/main/webapp/WEB-INF/templates/notification/web/</em></p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">READ</span></span><span class="token string"> clearfix&quot;</span></span> data<span class="token operator">-</span>id<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">NOTIFICATION_ID</span></span><span class="token string">&quot;</span></span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;media&quot;</span></span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;media-body&quot;</span></span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;contentSmall&quot;</span></span> data<span class="token operator">-</span>link<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">USER_PROFILE_URL</span></span><span class="token string">&quot;</span></span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;content&quot;</span></span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token punctuation">$</span>USER_PROFILE_URL<span class="token operator">&gt;</span>
            Your connection <span class="token punctuation">$</span>USER_FULL_NAME has updated his profile information
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;display:none;&quot;</span></span><span class="token operator">&gt;</span><span class="token punctuation">$</span>MESSAGE<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;lastUpdatedTime&quot;</span></span><span class="token operator">&gt;</span><span class="token punctuation">$</span>LAST_UPDATED_TIME<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;remove-item&quot;</span></span> data<span class="token operator">-</span>rest<span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;&quot;</span></span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>i <span class="token keyword">class</span><span class="token operator">=</span><span class="token interpolation-string"><span class="token string">&quot;uiIconClose uiIconLightGray&quot;</span></span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token interpolation-string"><span class="token string">/i&gt;&lt;/</span></span>span<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
</code></pre></div><p>2- Add the template builder for the Mail notification, create a new java class named <strong>UpdateProfileWebNotificationBuilder.java</strong> under <em>sample-notification/src/main/java/org/exoplatform/samples/notification/web</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span></span><span class="token class-name">NotificationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span></span><span class="token class-name">NotificationMessageUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">AbstractTemplateBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ChannelKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MessageInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">NotificationInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>service<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateContext</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">CommonsUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>webui<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">TimeConvertUtils</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Writer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Calendar</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Locale</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token static">USER_FULL_NAME</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token static">USER_PROFILE_URL</span></span><span class="token punctuation">;</span>
<span class="token comment">// All template builders should extend org.exoplatform.commons.api.notification.channel.template.AbstractTemplateBuilder</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpdateProfileWebNotificationBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTemplateBuilder</span> <span class="token punctuation">{</span>
  <span class="token comment">// each template builder will override function makeMessage which returns a MessageInfo object that represents the notification to be sent</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token class-name">MessageInfo</span> <span class="token function">makeMessage</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// retrieve notification from the context</span>
    <span class="token class-name">NotificationInfo</span> notification <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getNotificationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Detect the language of the receiver</span>
    <span class="token class-name">String</span> language <span class="token operator">=</span> <span class="token function">getLanguage</span><span class="token punctuation">(</span>notification<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create a templateContext for the Mail notification, note that we need to specify the channel here, otherwise it will take the default channel : Mail channel</span>
    <span class="token class-name">TemplateContext</span> templateContext <span class="token operator">=</span> <span class="token class-name">TemplateContext</span><span class="token punctuation">.</span><span class="token function">newChannelInstance</span><span class="token punctuation">(</span><span class="token class-name">ChannelKey</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">&quot;WEB_CHANNEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> notification<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> language<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Fill it with data, we should put all the variables with their values that will be replaced later in the notification template</span>
    <span class="token comment">// they will be prefixed with the $ symbol inside the template</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;USER_FULL_NAME&quot;</span><span class="token punctuation">,</span> notification<span class="token punctuation">.</span><span class="token function">getValueOwnerParameter</span><span class="token punctuation">(</span><span class="token constant">USER_FULL_NAME</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;USER_PROFILE_URL&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CommonsUtils</span><span class="token punctuation">.</span><span class="token function">getCurrentDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> notification<span class="token punctuation">.</span><span class="token function">getValueOwnerParameter</span><span class="token punctuation">(</span><span class="token constant">USER_PROFILE_URL</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// the following variables should be present in all web notification</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;NOTIFICATION_ID&quot;</span><span class="token punctuation">,</span> notification<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;MESSAGE&quot;</span><span class="token punctuation">,</span> notification<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;READ&quot;</span><span class="token punctuation">,</span>
            <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span><span class="token function">getValueOwnerParameter</span><span class="token punctuation">(</span><span class="token class-name">NotificationMessageUtils</span><span class="token punctuation">.</span><span class="token constant">READ_PORPERTY</span><span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;read&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;unread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Calendar</span> cal <span class="token operator">=</span> <span class="token class-name">Calendar</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cal<span class="token punctuation">.</span><span class="token function">setTimeInMillis</span><span class="token punctuation">(</span>notification<span class="token punctuation">.</span><span class="token function">getLastModifiedDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    templateContext<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;LAST_UPDATED_TIME&quot;</span><span class="token punctuation">,</span> <span class="token class-name">TimeConvertUtils</span><span class="token punctuation">.</span><span class="token function">convertXTimeAgoByTimeServer</span><span class="token punctuation">(</span>cal<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;EE, dd yyyy&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeConvertUtils</span><span class="token punctuation">.</span><span class="token constant">YEAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// compute the on-site notification content</span>
    <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token class-name">TemplateUtils</span><span class="token punctuation">.</span><span class="token function">processGroovy</span><span class="token punctuation">(</span>templateContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//binding the exception in case it was thrown by processing template</span>
    ctx<span class="token punctuation">.</span><span class="token function">setException</span><span class="token punctuation">(</span>templateContext<span class="token punctuation">.</span><span class="token function">getException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create the MessageInfo object</span>
    <span class="token class-name">MessageInfo</span> messageInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> messageInfo<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">makeDigest</span><span class="token punctuation">(</span><span class="token class-name">NotificationContext</span> notificationContext<span class="token punctuation">,</span> <span class="token class-name">Writer</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3- Add the template provider for Mail notifications, create a new java class named <strong>WebNotificationProvider.java</strong> under <em>sample-notification/src/main/java/org/exoplatform/samples/notification/web</em></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>mail</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TemplateConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TemplateConfigs</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>template<span class="token punctuation">.</span></span><span class="token class-name">TemplateProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>api<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PluginKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>container<span class="token punctuation">.</span>xml<span class="token punctuation">.</span></span><span class="token class-name">InitParams</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>exoplatform<span class="token punctuation">.</span>samples<span class="token punctuation">.</span>notification<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span></span><span class="token class-name">UpdateProfilePlugin</span></span><span class="token punctuation">;</span>

<span class="token comment">// Add the URL to load the template used by the notification plugin</span>
<span class="token annotation punctuation">@TemplateConfigs</span><span class="token punctuation">(</span>templates <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@TemplateConfig</span><span class="token punctuation">(</span>pluginId <span class="token operator">=</span> <span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">,</span> template <span class="token operator">=</span> <span class="token string">&quot;war:/templates/notification/mail/updateProfileMailNotification.gtmpl&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// All template providers should extend org.exoplatform.commons.api.notification.channel.template.TemplateProvider class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailNotificationProvider</span> <span class="token keyword">extends</span> <span class="token class-name">TemplateProvider</span> <span class="token punctuation">{</span>

  <span class="token comment">//constructor where we add the builder of mail notification to the list of templateBuilders inside the server</span>
  <span class="token keyword">public</span> <span class="token class-name">MailNotificationProvider</span><span class="token punctuation">(</span><span class="token class-name">InitParams</span> initParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>initParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>templateBuilders<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">PluginKey</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token class-name">UpdateProfilePlugin</span><span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UpdateProfileMailNotificationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4- Update the configuration by telling the Channel manager to use the new Web template provider for all email notifications related to the UpdateProfilePlugin. You need to add the following configuration in the file <strong>sample-notification/webapp/src/main/webapp/WEB-INF/conf/configuration.xml</strong> and add the new template provider under the Mail template provider :</p> <div class="language-xml extra-class"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Target service to update--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target-component</span><span class="token punctuation">&gt;</span></span>org.exoplatform.commons.api.notification.channel.ChannelManager<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target-component</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-plugin</span> <span class="token attr-name">profiles</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>all<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- unique name of our new plugin --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mail.channel.updateProfile.template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-method</span><span class="token punctuation">&gt;</span></span>registerTemplateProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-method</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- The new Template provider that we have just added --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples.notification.mail.MailNotificationProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-params</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- Target notification channel --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value-param</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>channel-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>MAIL_CHANNEL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value-param</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-params</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component-plugin</span> <span class="token attr-name">profiles</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>all<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- unique name of our new plugin --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>web.channel.updateProfile.template<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-method</span><span class="token punctuation">&gt;</span></span>registerTemplateProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-method</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- The new Template provider that we have just added --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>org.exoplatform.samples.notification.web.WebNotificationProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-params</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- Target notification channel --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value-param</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>channel-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>WEB_CHANNEL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value-param</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-params</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component-plugin</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>external-component-plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Our notications will look like this :</strong></p> <div><figure><img src="/img/notification/mail-sample-notif-templated.png" class="center"> <figcaption class="center-text">Mail notification decorated with a template</figcaption></figure> <figure><img src="/img/notification/web-sample-notif-templated.png" class="center"> <figcaption class="center-text">On site notification decorated with a template</figcaption></figure></div> <h2 id="overriding-email-notification-templates"><a href="#overriding-email-notification-templates" class="header-anchor">#</a> Overriding email notification templates</h2> <p>Thanks to the extensibility mechanisms in eXo platform, it is also possible to change how an existing notification is displayed.
The steps are pretty simple :</p> <p>1- Get the notification template to override</p> <p>2- copy it and paste it under the same relative path inside your extension.</p> <p><strong>Example</strong>: if the template is originally under <strong>social-extension.war/WEB-INF/notification/templates/LikePlugin.gtmpl</strong>, you will have just to :</p> <p>1- copy the file under <strong>custom-extension.war/WEB-INF/notification/templates/LikePlugin.gtmpl</strong></p> <p>2- Modify it to get the required changes applied.</p> <p>3- Deploy it, and restart the server</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>The template of the header <strong>NotificationHeader.gtmpl</strong> and the template of the footer <strong>NotificationFooter.gtmpl</strong> of all <strong>email</strong> notification are under <strong>commons-extension.war/WEB-INF/notification/templates/mail/</strong>
Both are overridable, using the same steps.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/developer-guide/simple-integration/event-listeners.html" class="prev">
        Event listeners
      </a></span> <span class="next"><a href="/guide/developer-guide/simple-integration/scheduled-jobs.html">
        Scheduled jobs
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.566fc5fe.js" defer></script><script src="/assets/js/2.a6004e7f.js" defer></script><script src="/assets/js/1.298b45b6.js" defer></script><script src="/assets/js/55.12746217.js" defer></script>
  </body>
</html>
