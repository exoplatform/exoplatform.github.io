<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security | eXo developers documentation</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="eXo documentation">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.aefff845.css" as="style"><link rel="preload" href="/assets/js/app.566fc5fe.js" as="script"><link rel="preload" href="/assets/js/2.a6004e7f.js" as="script"><link rel="preload" href="/assets/js/1.298b45b6.js" as="script"><link rel="preload" href="/assets/js/37.7c5839ea.js" as="script"><link rel="prefetch" href="/assets/js/10.225b8ad6.js"><link rel="prefetch" href="/assets/js/11.fcfda894.js"><link rel="prefetch" href="/assets/js/12.8288d633.js"><link rel="prefetch" href="/assets/js/13.61c54a2f.js"><link rel="prefetch" href="/assets/js/14.c8220840.js"><link rel="prefetch" href="/assets/js/15.cf0e000a.js"><link rel="prefetch" href="/assets/js/16.12acf4f0.js"><link rel="prefetch" href="/assets/js/17.60e99e03.js"><link rel="prefetch" href="/assets/js/18.402065f0.js"><link rel="prefetch" href="/assets/js/19.4cde00c8.js"><link rel="prefetch" href="/assets/js/20.e735bd74.js"><link rel="prefetch" href="/assets/js/21.4d9631b7.js"><link rel="prefetch" href="/assets/js/22.38c3a0bb.js"><link rel="prefetch" href="/assets/js/23.96cba659.js"><link rel="prefetch" href="/assets/js/24.6a323bb6.js"><link rel="prefetch" href="/assets/js/25.d314e852.js"><link rel="prefetch" href="/assets/js/26.781556fb.js"><link rel="prefetch" href="/assets/js/27.db2034f7.js"><link rel="prefetch" href="/assets/js/28.bdd32a1a.js"><link rel="prefetch" href="/assets/js/29.7705a494.js"><link rel="prefetch" href="/assets/js/3.535cbfb5.js"><link rel="prefetch" href="/assets/js/30.5235d8d8.js"><link rel="prefetch" href="/assets/js/31.12dc91a0.js"><link rel="prefetch" href="/assets/js/32.7b9193b7.js"><link rel="prefetch" href="/assets/js/33.d786c476.js"><link rel="prefetch" href="/assets/js/34.82a8e2bb.js"><link rel="prefetch" href="/assets/js/35.bfed5ce5.js"><link rel="prefetch" href="/assets/js/36.08aae2f6.js"><link rel="prefetch" href="/assets/js/38.5a9c6f81.js"><link rel="prefetch" href="/assets/js/39.64b36a7a.js"><link rel="prefetch" href="/assets/js/4.36aa3fdb.js"><link rel="prefetch" href="/assets/js/40.91490da1.js"><link rel="prefetch" href="/assets/js/41.1bb028a9.js"><link rel="prefetch" href="/assets/js/42.2b2e6226.js"><link rel="prefetch" href="/assets/js/43.3eb1d2ff.js"><link rel="prefetch" href="/assets/js/44.aff75618.js"><link rel="prefetch" href="/assets/js/45.ae4c3883.js"><link rel="prefetch" href="/assets/js/46.c22a02ed.js"><link rel="prefetch" href="/assets/js/47.c2a86641.js"><link rel="prefetch" href="/assets/js/48.49f8e4ff.js"><link rel="prefetch" href="/assets/js/49.ef6e633d.js"><link rel="prefetch" href="/assets/js/5.8d70814d.js"><link rel="prefetch" href="/assets/js/50.82b2cb38.js"><link rel="prefetch" href="/assets/js/51.26af3c19.js"><link rel="prefetch" href="/assets/js/52.f2d45ccb.js"><link rel="prefetch" href="/assets/js/53.ecd43fd3.js"><link rel="prefetch" href="/assets/js/54.17169cc4.js"><link rel="prefetch" href="/assets/js/55.12746217.js"><link rel="prefetch" href="/assets/js/56.77bdaee4.js"><link rel="prefetch" href="/assets/js/57.0b269ef5.js"><link rel="prefetch" href="/assets/js/58.f7328ad9.js"><link rel="prefetch" href="/assets/js/59.5a4f9f04.js"><link rel="prefetch" href="/assets/js/6.477d5345.js"><link rel="prefetch" href="/assets/js/60.30d9251f.js"><link rel="prefetch" href="/assets/js/61.8b948aa3.js"><link rel="prefetch" href="/assets/js/62.5a0f0c07.js"><link rel="prefetch" href="/assets/js/63.e454eff4.js"><link rel="prefetch" href="/assets/js/64.a49d269e.js"><link rel="prefetch" href="/assets/js/65.bfc4b138.js"><link rel="prefetch" href="/assets/js/66.25150fb5.js"><link rel="prefetch" href="/assets/js/67.f5cc4cec.js"><link rel="prefetch" href="/assets/js/68.765560e5.js"><link rel="prefetch" href="/assets/js/69.1b311bba.js"><link rel="prefetch" href="/assets/js/7.75df615e.js"><link rel="prefetch" href="/assets/js/70.1d2c355e.js"><link rel="prefetch" href="/assets/js/71.764ddbf9.js"><link rel="prefetch" href="/assets/js/72.45bf8487.js"><link rel="prefetch" href="/assets/js/73.5834c41d.js"><link rel="prefetch" href="/assets/js/74.981741a8.js"><link rel="prefetch" href="/assets/js/75.60c0af0f.js"><link rel="prefetch" href="/assets/js/76.44b7b182.js"><link rel="prefetch" href="/assets/js/77.d4e20165.js"><link rel="prefetch" href="/assets/js/78.c33db6b5.js"><link rel="prefetch" href="/assets/js/79.c55e2cf6.js"><link rel="prefetch" href="/assets/js/80.3da0ce0e.js"><link rel="prefetch" href="/assets/js/81.09e71458.js"><link rel="prefetch" href="/assets/js/82.d36b7bb4.js"><link rel="prefetch" href="/assets/js/83.102fdcea.js"><link rel="prefetch" href="/assets/js/84.8a64b178.js"><link rel="prefetch" href="/assets/js/85.fed6c251.js"><link rel="prefetch" href="/assets/js/86.70751800.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f3569c9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aefff845.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">eXo developers documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/getting-started/Introduction.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/administration/" class="nav-link router-link-active">
  Technical Administration
</a></div><div class="nav-item"><a href="/guide/developer-guide/rest-api.html" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="https://github.com/exoplatform/exo-community/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Q&amp;A
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/getting-started/Introduction.html" class="nav-link">
  Getting Started
</a></div><div class="nav-item"><a href="/administration/" class="nav-link router-link-active">
  Technical Administration
</a></div><div class="nav-item"><a href="/guide/developer-guide/rest-api.html" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="https://github.com/exoplatform/exo-community/discussions" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Q&amp;A
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/administration/" class="sidebar-heading clickable router-link-active open"><span>Technical Administration Guide</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/administration/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/administration/database.html" class="sidebar-link">Database</a></li><li><a href="/administration/backup-restore.html" class="sidebar-link">Backup and Restore</a></li><li><a href="/administration/indexing.html" class="sidebar-link">Indexing</a></li><li><a href="/administration/LDAP.html" class="sidebar-link">LDAP Integration</a></li><li><a href="/administration/oauth-integration.html" class="sidebar-link">OAuth Integration</a></li><li><a href="/administration/saml-integration.html" class="sidebar-link">SAML Integration</a></li><li><a href="/administration/addons-management.html" class="sidebar-link">Add-ons Management</a></li><li><a href="/administration/security.html" aria-current="page" class="active sidebar-link">Security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/administration/security.html#jaas-realm-configuration" class="sidebar-link">JAAS Realm configuration</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#enabling-https" class="sidebar-link">Enabling HTTPS</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#rememberme-token-generation" class="sidebar-link">RememberMe Token Generation</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#login-brute-force-attacks-protection" class="sidebar-link">Login Brute Force Attacks Protection</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#xss-protection" class="sidebar-link">XSS Protection</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#samesite-configuration" class="sidebar-link">SameSite Configuration</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#secured-mongodb" class="sidebar-link">Secured MongoDB</a></li><li class="sidebar-sub-header"><a href="/administration/security.html#rest-api-exposure" class="sidebar-link">Rest Api exposure</a></li></ul></li><li><a href="/administration/jmx-rest-management.html" class="sidebar-link">JMX/REST Management</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="security"><a href="#security" class="header-anchor">#</a> Security</h1> <p>This chapter introduces you to the security configuration in eXo Platform:</p> <ul><li><code>JAAS Realm configuration</code> Instructions on how to configure JAAS Realm.</li> <li><code>Enabling HTTPS</code> To enable security access, you can either run eXo Platform itself in HTTPS, or more commonly, use a reverse proxy like Apache.</li> <li><code>Password encryption key of RememberMe</code> Information about the file location and steps to update the &quot;Remember My Login&quot; password encryption key.</li> <li><code>Anti Brute Force</code> To configure the mechanim that protects against brute force attacks on password authentication.</li> <li><code>XSS protection</code> To activate XSS protection mechanisms.</li> <li><code>SameSite Configuration</code> To configure SameSite property for cookies</li> <li><code>Securing the MongoDB Database</code> How to secure eXo chat database.</li> <li><code>Rest Api exposure</code> List of REST API exposed by eXo Platform.</li></ul> <h2 id="jaas-realm-configuration"><a href="#jaas-realm-configuration" class="header-anchor">#</a> JAAS Realm configuration</h2> <p>eXo Platform relies on JAAS for propagating the user identity and roles to the different applications deployed on the server. The JAAS realm is used by all eXo Platform applications and even propagated to the JCR for <a href="/reference/html/JCR.AccessControl.html">Access Control</a>.
Therefore, if you need to change the JAAS configuration, consider that your change impacts a lot and it may require you to unpackage and modify some <code>.war</code> files.</p> <p>This section explains:</p> <ul><li><code>What is JAAS Realm?</code></li> <li><code>Declaring JAAS Realm in eXo Platform</code></li> <li><code>List of applications using Realm</code></li></ul> <h3 id="what-is-jaas-realm"><a href="#what-is-jaas-realm" class="header-anchor">#</a> What is JAAS Realm?</h3> <p>The JAAS configuration requires a <a href="https://docs.oracle.com/javase/1.5.0/docs/guide/security/jaas/tutorials/LoginConfigFile.html" target="_blank" rel="noopener noreferrer">login.config file<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
This file contains one (or more) entry which is called a &quot;Realm&quot;. Each entry declares a Realm name and at least one login module. Each login module consists of a Java class and some parameters which are specified by the class.</p> <p>Below is the default Realm in the Tomcat bundle.</p> <div class="language-json extra-class"><pre class="language-json"><code>    gatein-domain <span class="token punctuation">{</span>
      org.gatein.sso.integration.SSODelegateLoginModule required
        enabled=<span class="token string">&quot;#{gatein.sso.login.module.enabled}&quot;</span>
        delegateClassName=<span class="token string">&quot;#{gatein.sso.login.module.class}&quot;</span>
        portalContainerName=portal
        realmName=gatein-domain
        password-stacking=useFirstPass;
      org.exoplatform.services.security.j2ee.TomcatLoginModule required
        portalContainerName=portal
        realmName=gatein-domain;
    <span class="token punctuation">}</span>;
</code></pre></div><p>In which:</p> <ul><li><p><code>gatein-domain</code> is the <strong>Realm name</strong> which will be refered by applications. If you change this default name, you need to re-configure all the applications that use the Realm (listed later).</p></li> <li><p>Two required <strong>login modules</strong> are: <em>org.gatein.sso.integration.SSODelegateLoginModule</em> and <em>org.exoplatform.services.security.j2ee.TomcatLoginModule</em>. The first, if authentication succeeds, will create an <em>Identity</em> object and save it into a shared state map, then the object can be used by the second.
These are some login modules available in eXo Platform. Refer to <code>Existing login modules</code> to understand how they match the login scenarios.</p></li></ul> <h3 id="declaring-jaas-realm-in-exo-platform"><a href="#declaring-jaas-realm-in-exo-platform" class="header-anchor">#</a> Declaring JAAS Realm in eXo Platform</h3> <h4 id="in-the-tomcat-bundle"><a href="#in-the-tomcat-bundle" class="header-anchor">#</a> In the Tomcat bundle</h4> <ul><li><p>The default Realm is declared in the <code>$PLATFORM_TOMCAT_HOME/conf/jaas.conf</code> file. Its content is exactly the above example.</p></li> <li><p>A &quot;security domain&quot; property in <code>$PLATFORM_TOMCAT_HOME/gatein/conf/exo.properties</code> (about this file, see <code>Configuration overview</code> needs to be set equal to the Realm name:</p></li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">    exo.security.domain</span><span class="token punctuation">=</span><span class="token value attr-value">gatein-domain</span>
</code></pre></div><h3 id="list-of-applications-using-realm"><a href="#list-of-applications-using-realm" class="header-anchor">#</a> List of applications using Realm</h3> <p>If an application (.war) uses the Realm for authentication and
authorization, it will refer to the Realm name with either of the
following lines.</p> <ul><li><p>In <code>WEB-INF/jboss-web.xml</code>:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>security-domain</span><span class="token punctuation">&gt;</span></span>java:/jaas/gatein-domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>security-domain</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>In <code>WEB-INF/web.xml</code>:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>realm-name</span><span class="token punctuation">&gt;</span></span>gatein-domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>realm-name</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>In <code>META-INF/context.xml</code>:</p> <div class="language-xml extra-class"><pre class="language-xml"><code>appName='gatein-domain'
</code></pre></div></li></ul> <p>As mentioned above, if you change &quot;<code>gatein-domain</code>&quot;, you need to
re-configure all the applications that use the Realm to refer to the new
Realm. Here is the list of webapps and the files you need to
re-configure:</p> <p><strong>In the Tomcat bundle:</strong></p> <ul><li><code>portal.war</code>: <code>/WEB-INF/jboss-web.xml</code>, <code>/WEB-INF/web.xml</code>,
<code>/META-INF/context.xml</code>.</li> <li><code>rest.war</code>: <code>/WEB-INF/jboss-web.xml</code>, <code>/WEB-INF/web.xml</code>.</li> <li><code>ecm-wcm-extension.war</code>: <code>/WEB-INF/jboss-web.xml</code>.</li> <li><code>calendar-extension.war</code>: <code>/WEB-INF/jboss-web.xml</code>.</li> <li><code>forum-extension.war</code>: <code>/WEB-INF/jboss-web.xml</code>.</li> <li><code>wiki-extension.war</code>: <code>/WEB-INF/jboss-web.xml</code>.</li> <li><code>ecm-wcm-core.war</code>: <code>/WEB-INF/jboss-web.xml</code>.</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The <code>.war</code> files are located under the <code>$PLATFORM_TOMCAT_HOME/webapps</code>
folder.</p></div> <h2 id="enabling-https"><a href="#enabling-https" class="header-anchor">#</a> Enabling HTTPS</h2> <p>In order to enable HTTPS, you can either:</p> <ul><li><code>Use a reverse proxy</code>, such as Apache HTTPd or Nginx, to set up an HTTPS virtual host that runs in front of eXo Platform. This is the recommended way.
Or:</li> <li><code>Run eXo Platform itself over HTTPS</code></li></ul> <p>In both cases, you must have a valid SSL certificate. For testing purpose, you can generate a self-signed SSL certificate.
For a production environment, a <code>verified SSL certificate</code> should be used.</p> <h3 id="generating-a-self-signed-certificate"><a href="#generating-a-self-signed-certificate" class="header-anchor">#</a> Generating a self-signed certificate</h3> <p>Generating a self-signed certificate can be done with <a href="https://www.openssl.org/" target="_blank" rel="noopener noreferrer">OpenSSL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Once again, a self-signed certificate must be used only for testing purpose, never in production. Use the following command to generate the certificate:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>openssl req <span class="token parameter variable">-x509</span> <span class="token parameter variable">-nodes</span> <span class="token parameter variable">-newkey</span> rsa:2048 <span class="token parameter variable">-keyout</span> cert-key.pem <span class="token parameter variable">-out</span> cert.pem <span class="token parameter variable">-subj</span> <span class="token punctuation">\</span>'/O<span class="token operator">=</span>MYORG/OU<span class="token operator">=</span>MYUNIT/C<span class="token operator">=</span>MY/ST<span class="token operator">=</span>MYSTATE/L<span class="token operator">=</span>MYCITY/CN<span class="token operator">=</span>proxy1.com<span class="token punctuation">\</span>' <span class="token parameter variable">-days</span> <span class="token number">730</span>
</code></pre></div><p>You will use cert-key.pem to certificate the Apache/Nginx server proxy1.com, so the part &quot;<em>CN=proxy1.com</em>&quot; is mportant.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When using a self-signed certificate, users will need to point their browser to <em><a href="https://proxy1.com" target="_blank" rel="noopener noreferrer">https://proxy1.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em> and accept the security exception.</p></div> <h3 id="using-a-reverse-proxy-for-https-in-front-of-exo-platform"><a href="#using-a-reverse-proxy-for-https-in-front-of-exo-platform" class="header-anchor">#</a> Using a reverse proxy for HTTPS in front of eXo Platform</h3> <p>Apache or Nginx can both be used as a reverse proxy in front of eXo Platform. The role of the reverse proxy server is to catch HTTPS requests coming from the http clients (e.g web browsers) and to relay them to eXo Platform either via AJP or via HTTP protocol. The following diagram depicts the case described in this section:</p> <p><img src="images/https_reverse_prx_diagram.png" alt="image0"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>At this stage, we assume you already have an <code>SSL certificate</code>, either issued by an official certification authority or
self-signed (for testing).</p> <p>The examples below will let you setup a basic installation with ssl enabled. You should fine tune your installation before opening it on the web. Mozilla provide a <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="noopener noreferrer">great site<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to help you to find a configuration adapted to your needs.</p></div> <h4 id="configuring-apache"><a href="#configuring-apache" class="header-anchor">#</a> Configuring Apache</h4> <p>Before you start, note that for clarity, not all details of the Apache server configuration are described here. The configuration may vary depending on Apache version and your OS, so consult <a href="http://httpd.apache.org/docs/" target="_blank" rel="noopener noreferrer">Apache documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> if you need.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The supported version of Apache is 2.4 which should be used in a supported version of OS. You can learn more about supported environments <a href="https://www.exoplatform.com/terms-conditions/supported-environments.pdf" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h5 id="required-modules"><a href="#required-modules" class="header-anchor">#</a> Required modules</h5> <p>You need mod_ssl, mod_proxy. They are all standard Apache2 modules, so no installation is required. You just need to enable them with the following command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>    <span class="token function">sudo</span> a2enmod ssl proxy proxy_http headers
</code></pre></div><h5 id="configuring-a-virtual-host-for-the-ssl-port"><a href="#configuring-a-virtual-host-for-the-ssl-port" class="header-anchor">#</a> Configuring a virtual host for the SSL port</h5> <p>Add this to site configuration (you can override the default ssl site <code>/etc/apache2/sites-enabled/default-ssl.conf</code> or create your own site):</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">*:</span>80</span><span class="token punctuation">&gt;</span></span>
        ServerName proxy1.com
        Redirect / https://proxy1.com/
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">*:</span>443</span><span class="token punctuation">&gt;</span></span>
        ServerName proxy1.com
        ProxyPass / http://exo1.com:8080/
        ProxyPassReverse / http://exo1.com:8080/
        ProxyRequests Off
        ProxyPreserveHost On
        RequestHeader set &quot;X-Forwarded-Proto&quot; expr=%{REQUEST_SCHEME}

        ProxyPass /cometd ws://exo1.com:8080/cometd max=200 acquire=5000 retry=5 disablereuse=on flushpackets=on

        SSLEngine On
        SSLCertificateFile /path/to/folder/from/certificate/cert.pem
        SSLCertificateKeyFile /path/to/folder/from/certificate/cert-key.pem
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="configuring-nginx"><a href="#configuring-nginx" class="header-anchor">#</a> Configuring Nginx</h4> <p>Instructions for installing Nginx can be found <a href="http://wiki.nginx.org/Install" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. On Debian and Ubuntu you can install Nginx with the following command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>   <span class="token function">apt-get</span> <span class="token function">install</span> nginx
</code></pre></div><p>Configure the server <em>proxy1.com</em> at port <em>443</em> like this (you can put the configuration in a file like <code>/etc/nginx/sites-enabled/proxy1.com</code>):</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> proxy1.com</span><span class="token punctuation">;</span>

        <span class="token comment"># Redirect all HTTP requests to HTTPS with a 301 Moved Permanently response.</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> proxy1.com</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">ssl</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/file/mycert.pem</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/file/mykey.pem</span><span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://exo1.com:8080</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> /cometd/cometd</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://exo1.com:8080</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre></div><p>The configuration here is a simple one and it works. It can be tuned for advanced usages.</p> <h4 id="configuring-the-http-connector"><a href="#configuring-the-http-connector" class="header-anchor">#</a> Configuring the HTTP connector</h4> <p>In eXo Platform distribution, there is a default HTTP (8080) connector.</p> <p>In any case, you should configure that connector so that eXo Platform is aware of the proxy in front of it.</p> <p>Set the following property in <code>$PLATFORM_TOMCAT_HOME/gatein/conf/exo.properties</code> file:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">    exo.base.url</span><span class="token punctuation">=</span><span class="token value attr-value">https://proxy1.com</span>
</code></pre></div><p>The connector is configured in <code>$PLATFORM_TOMCAT_HOME/conf/server.xml</code>. Add proxy parameters like this:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.0.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.coyote.http11.Http11NioProtocol<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">enableLookups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">disableUploadTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">compression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span> <span class="token attr-name">compressionMinSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2048<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">noCompressionUserAgents</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.*MSIE 6.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">compressableMimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html,text/xml,text/plain,text/css,text/javascript<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">proxyName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>proxy1.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">proxyPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>443<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="running-exo-platform-itself-under-https"><a href="#running-exo-platform-itself-under-https" class="header-anchor">#</a> Running eXo Platform itself under HTTPS</h3> <p>In the previous section you learnt to configure a reverse proxy in front of eXo Platform, and it is the proxy which encrypts the requests and responses. Alternatively you can configure eXo Platform to allow HTTPS access directly, so no proxy between browsers and eXo Platform. See the following diagram :</p> <p><img src="images/https_direct_access_diagram.png" alt="image1"></p> <h4 id="configuring-exo-platform-s-tomcat"><a href="#configuring-exo-platform-s-tomcat" class="header-anchor">#</a> Configuring eXo Platform's Tomcat</h4> <ol><li><p>Set the following property in <code>$PLATFORM_TOMCAT_HOME/gatein/conf/exo.properties</code> file:</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name"> exo.base.url</span><span class="token punctuation">=</span><span class="token value attr-value">https://exo1.com:8443</span>
</code></pre></div></li> <li><p>Edit the <code>$PLATFORM_TOMCAT_HOME/conf/server.xml</code> file by commenting the following lines:</p> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">address</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.0.0.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8080<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.coyote.http11.Http11NioProtocol<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">enableLookups</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectPort</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">connectionTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">disableUploadTimeout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">URIEncoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">compression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>off<span class="token punctuation">&quot;</span></span> <span class="token attr-name">compressionMinSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2048<span class="token punctuation">&quot;</span></span>
     <span class="token attr-name">noCompressionUserAgents</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.*MSIE 6.*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">compressableMimeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html,text/xml,text/plain,text/css,text/javascript<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>Uncomment the following lines and edit with your <code>keystoreFile</code> and <code>keystorePass</code> values:</p> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Connector</span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8443<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.coyote.http11.Http11Protocol<span class="token punctuation">&quot;</span></span> <span class="token attr-name">SSLEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">maxThreads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>150<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scheme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https<span class="token punctuation">&quot;</span></span> <span class="token attr-name">secure</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">clientAuth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sslProtocol</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TLS<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">keystoreFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/path/to/file/serverkey.jks<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name">keystorePass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></li></ol> <p>After starting eXo Platform, you can connect to <em><a href="https://exo1.com:8443/portal" target="_blank" rel="noopener noreferrer">https://exo1.com:8443/portal<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em>. If you are testing with dummy server names, make sure you created the host &quot;exo1.com&quot; in the file <code>/etc/hosts</code>.</p> <h2 id="rememberme-token-generation"><a href="#rememberme-token-generation" class="header-anchor">#</a> RememberMe Token Generation</h2> <p>eXo Platform supports the &quot;Remember My Login&quot; feature. This guideline
explains how the feature works, and how to update the password
encryption key in server side for security purpose.</p> <h3 id="how-the-feature-works"><a href="#how-the-feature-works" class="header-anchor">#</a> How the feature works?</h3> <p>If users select &quot;Remember My Login&quot; when they log in, 2 tokens are generated : one named <code>selector</code>
and one named <code>validator</code>. The validator is hashed with algorithm <code>PBKDF2WithHmacSHA1</code>.
<code>selector</code> and hashed <code>validator</code> are stored in database, associated to the username, and <code>selector.validator</code> is sent as cookie to the user.</p> <p>To validate the cookie, the <code>selector</code> and the <code>validator</code> and extracted, then the hash of the validator is calculated, and compared with the value in the database. If both match, token is valid. If it is not expired, the associated user is then automatically loggued in.</p> <h2 id="login-brute-force-attacks-protection"><a href="#login-brute-force-attacks-protection" class="header-anchor">#</a> Login Brute Force Attacks Protection</h2> <p>To prevent an attack based on brute force on login/password form, a built-in protection mechanism exists when multiple failed login attempts occur in a short time, the target user account is temporarily locked for a few minutes. When an account is locked, the user can immediately unlock it by resetting its password through a <strong>forgot password</strong> request.
Two properties control the brute force attack protection mechanism.
To configure it, you can add them in <code>exo.properties</code>.
The following property determines the number of unsuccessful login attempts before the account is locked. The default value is attempts :</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">   exo.authentication.antibruteforce.maxAuthenticationAttempts</span><span class="token punctuation">=</span><span class="token value attr-value">5</span>
</code></pre></div><p>The following property determines how long (in minutes) an account is locked when the protection mechanism is triggered. The default value is 10 minutes :</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">   exo.authentication.antibruteforce.blockingTime</span><span class="token punctuation">=</span><span class="token value attr-value">10</span>
</code></pre></div><h2 id="xss-protection"><a href="#xss-protection" class="header-anchor">#</a> XSS Protection</h2> <p>Even if the XSS protection is handled in the PRODUCT development, some protections can be added on the server side to protect against external threats. They are essentially based on HTTP headers added to the responses to ask the modern browsers to avoid such attacks.</p> <p>Additional configuration options can be found on the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy" target="_blank" rel="noopener noreferrer">Content-security-Policy header definition<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="add-xss-protection-headers-on-apache"><a href="#add-xss-protection-headers-on-apache" class="header-anchor">#</a> Add XSS protection headers on Apache</h3> <p>To manipulate the response headers, the Apache module <a href="https://httpd.apache.org/docs/2.4/mod/mod_headers.html" target="_blank" rel="noopener noreferrer">mod_headers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> must be activated and the following lines added on your configuration :</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VirtualHost</span> <span class="token attr-name"><span class="token namespace">*:</span>80</span><span class="token punctuation">&gt;</span></span>
            ...
            # XSS Protection
            Header always append X-Frame-Options SAMEORIGIN
            Header always append X-XSS-Protection 1
            Header always append Content-Security-Policy &quot;frame-ancestors 'self'&quot;
            ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VirtualHost</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="add-xss-protection-headers-on-nginx"><a href="#add-xss-protection-headers-on-nginx" class="header-anchor">#</a> Add XSS protection headers on Nginx</h3> <p>Add the following line in the <code>http</code> or <code>server</code> part of your Nginx configuration :</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>    ...
    <span class="token comment"># XSS Protection</span>
    <span class="token directive"><span class="token keyword">add_header</span> X-Frame-Options SAMEORIGIN</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> X-XSS-Protection <span class="token number">1</span></span><span class="token punctuation">;</span>
    add_header Content-Security-Policy &quot;frame-ancestors 'self'&quot;
    ...
</code></pre></div><h2 id="samesite-configuration"><a href="#samesite-configuration" class="header-anchor">#</a> SameSite Configuration</h2> <p>SameSite is a property set on HTTP cookies. It can prevent some CSRF attacks. SameSite property can take one of theses values : None, Strict, and Lax</p> <ol><li>With value <strong>None</strong>, when a request is done on eXo Server, there is no verification on the referer. The cookies is used. For example, when a user receives a malicious email, containing a link forged to call a data-altering REST endpoint such as deleting a space, changing a permission, etc.. if the user has a valid session on eXo, clicking the link would alter data on their behalf. It is a CSRF attack.</li> <li>With value <strong>Strict</strong>; when a request arrives on the eXo server, the referer is verified. If the referer has a different domain than the eXo server's domain, the request will not use the cookie. In the situation described above, the request would not be directly executed. The user would be redirected to the login page first. This behaviour is also applied for HTTP GET requests. So, when a user clicks on a link in a notification for example, he has to login again. With this value, all SSO systems (SAML, OAuth, OpenIdConnect ...), generally based on redirections between different hosts, <strong>will not work</strong>.</li> <li>With value <strong>Lax</strong>; when a request arrives on the eXo server, the referer is also verified. If the referer has a different domain than the eXo server's domain, only GET requests will use the cookie. So this intermediate option allows to use links read only endpoints in email notifications, and still protect sensitive requests that may alter data.</li></ol> <p>By default, eXo uses <strong>Lax</strong> policy in order to have email notification links and SSO configurations work. It can be  changed by configuration if a different value is needed. For that, rename file (if not already done) <code>$PLATFORM_TOMCAT_HOME/bin/setenv-customize.sample.sh</code> in <code>$PLATFORM_TOMCAT_HOME/bin/setenv-customize.sh</code> and then uncomment the line</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">    CATALINA_OPTS</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;$CATALINA_OPTS -Dexo.cookie.samesite=Lax&quot;</span>
    ...
</code></pre></div><p>Then modify the value to use <em>None</em> or <em>Strict</em></p> <p>For Windows environment, use the file <code>$PLATFORM_TOMCAT_HOME/bin/setenv-customize.sample.bat</code></p> <h2 id="secured-mongodb"><a href="#secured-mongodb" class="header-anchor">#</a> Secured MongoDB</h2> <p>For a quick setup, the add-on by default uses a local and none-authorization connection. However, in production it is likely you will secure your MongoDB, so authorization is required. Below are steps to do this.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Read <a href="http://docs.mongodb.org" target="_blank" rel="noopener noreferrer">MongoDB documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for MongoDB security. This setup procedure is applied for <a href="https://docs.mongodb.com/v3.2/" target="_blank" rel="noopener noreferrer">MongoDB 3.2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <ol><li><p>Start MongoDB and connect to the shell to create a database named <em>admin</em>. Add a user with role <em>userAdminAnyDatabase</em>.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>     $ mongo
      <span class="token operator">&gt;</span> use admin
      <span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;admin&quot;</span>, pwd: <span class="token string">&quot;admin&quot;</span>, roles: <span class="token punctuation">[</span><span class="token punctuation">{</span>role: <span class="token string">&quot;userAdminAnyDatabase&quot;</span>, db: <span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre></div></li> <li><p>Edit MongoDB configuration to turn on authentication, then restart the server.</p> <div class="language-conf extra-class"><pre class="language-text"><code>     # mongodb.conf
     # Your MongoDB host.
     bind_ip = 192.168.1.81

     # The default MongoDB port
     port = 27017

     # Turn on authentication
     auth=true
</code></pre></div></li> <li><p>Create a user having <em>readWrite</em> role in the database <em>chat</em> (you can name the database as your desire).</p> <div class="language-shell extra-class"><pre class="language-shell"><code>     $ mongo <span class="token parameter variable">-port</span> <span class="token number">27017</span> <span class="token parameter variable">-host</span> <span class="token number">192.168</span>.1.81 <span class="token parameter variable">-u</span> admin <span class="token parameter variable">-p</span> admin <span class="token parameter variable">-authenticationDatabase</span> admin
      <span class="token operator">&gt;</span> use chat
      <span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;exo&quot;</span>, pwd: <span class="token string">&quot;exo&quot;</span>, roles: <span class="token punctuation">[</span><span class="token punctuation">{</span>role: <span class="token string">&quot;readWrite&quot;</span>, db: <span class="token string">&quot;chat&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre></div></li> <li><p>Verify the authentication/authorization of the new user:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>     $ mongo <span class="token parameter variable">-port</span> <span class="token number">27017</span> <span class="token parameter variable">-host</span> <span class="token number">192.168</span>.1.81 <span class="token parameter variable">-u</span> exo <span class="token parameter variable">-p</span> exo <span class="token parameter variable">-authenticationDatabase</span> chat
      <span class="token operator">&gt;</span> use chat
      <span class="token operator">&gt;</span> db.placeholder.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>description: <span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token operator">&gt;</span> db.placeholder.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Create a <code>configuration file</code> containing these below parameters.</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">     dbName</span><span class="token punctuation">=</span><span class="token value attr-value">chat</span>
<span class="token key attr-name">     dbServerHost</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.1.81</span>
<span class="token key attr-name">     dbServerPort</span><span class="token punctuation">=</span><span class="token value attr-value">27017</span>
<span class="token key attr-name">     dbAuthentication</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">     dbUser</span><span class="token punctuation">=</span><span class="token value attr-value">exo</span>
<span class="token key attr-name">     dbPassword</span><span class="token punctuation">=</span><span class="token value attr-value">exo</span>
</code></pre></div></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The parameters above correspond with the values used during creating authorization for MongoDB.</p></div> <h2 id="rest-api-exposure"><a href="#rest-api-exposure" class="header-anchor">#</a> Rest Api exposure</h2> <p>eXo Platform exposes a list of Rest API methods. They are used internally by the deployed components but can also be used by your users.</p> <p>Depending on your use cases, it could be (highly) recommended to block the public access to some of them.</p> <ul><li><code>/rest/loginhistory/loginhistory/AllUsers</code> : to avoid information disclosure and for performance issue.</li> <li><code>/rest/private/loginhistory/loginhistory/AllUsers/*</code> : to avoid information disclosure and for performance issue.</li> <li><code>/rest/jcr/repository/collaboration/Trash</code> : to avoid information disclosure.</li> <li><code>/rest/</code> : Avoid rest services discovery.</li> <li><code>/portal/rest</code> : Avoid rest services discovery.</li></ul> <p>The following configuration examples will allow you to block the previously listed Rest URLs with Apache or Nginx.</p> <h3 id="block-sensitive-rest-urls-with-apache"><a href="#block-sensitive-rest-urls-with-apache" class="header-anchor">#</a> Block sensitive Rest urls with Apache</h3> <div class="language-xml extra-class"><pre class="language-xml"><code>          # Block login history for performance and security reasons
          RewriteRule             &quot;/rest/loginhistory/loginhistory/AllUsers&quot;            - [L,NC,R=403]
          RewriteRule             &quot;/rest/private/loginhistory/loginhistory/AllUsers/*&quot;  - [L,NC,R=403]

          # Block access to trash folder
          RewriteRule             &quot;/rest/jcr/repository/collaboration/Trash&quot;            - [L,NC,R=403]

          # Don't expose REST APIs listing 
          RewriteRule             &quot;^/rest/?$&quot;         -                   [NC,F,L]
          RewriteRule             &quot;^/portal/rest/?$&quot;  -                   [NC,F,L]
</code></pre></div><h3 id="block-sensitive-rest-urls-with-nginx"><a href="#block-sensitive-rest-urls-with-nginx" class="header-anchor">#</a> Block sensitive Rest urls with Nginx</h3> <p>You can create redirection rules in several ways with nginx, this is one of the possibles :</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code>          <span class="token comment"># Block login history for performance and security reasons</span>
          <span class="token directive"><span class="token keyword">location</span> /rest/loginhistory/loginhistory/AllUsers</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
          <span class="token directive"><span class="token keyword">location</span> /rest/private/loginhistory/loginhistory/AllUsers</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

          <span class="token comment"># Block access to trash folder</span>
          <span class="token directive"><span class="token keyword">location</span> /rest/jcr/repository/collaboration/Trash</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

          <span class="token comment"># Don't expose REST APIs listing </span>
          <span class="token directive"><span class="token keyword">location</span> ~ ^/rest/?$</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
          <span class="token directive"><span class="token keyword">location</span> ~ ^/portal/rest/?$</span> <span class="token punctuation">{</span> <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/administration/addons-management.html" class="prev">
        Add-ons Management
      </a></span> <span class="next"><a href="/administration/jmx-rest-management.html">
        JMX/REST Management
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.566fc5fe.js" defer></script><script src="/assets/js/2.a6004e7f.js" defer></script><script src="/assets/js/1.298b45b6.js" defer></script><script src="/assets/js/37.7c5839ea.js" defer></script>
  </body>
</html>
