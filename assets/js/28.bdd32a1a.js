(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{379:function(e,a,t){"use strict";t.r(a);var o=t(14),s=Object(o.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"backup-and-restore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backup-and-restore"}},[e._v("#")]),e._v(" Backup and Restore")]),e._v(" "),a("blockquote",[a("p",[e._v("Backup is necessary for safety. Data loss may happen in such cases as broken devices, software failures, attacks of viruses and hackers. By saving copies of your working data to a separated and dedicated storage, you can restore your data and recover eXo Platform in such cases.\nThe eXo Platform data consists of File System Data and SQL Data. The backup does not require any specific tools. You will use any OS backup utilities and any DBMS backup tools.\nThe following topics are covered in this chapter:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("Planning your backup")]),e._v(" Necessary information about planning your backup.")]),e._v(" "),a("li",[a("code",[e._v("Backup and Restore")]),e._v(" Instructions on how to back up and restore eXo Platform.")]),e._v(" "),a("li",[a("code",[e._v("Backup MongoDB database for eXo chat")]),e._v(" Instructions on how to back up eXo chat Database.")])])]),e._v(" "),a("h2",{attrs:{id:"planning-your-backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#planning-your-backup"}},[e._v("#")]),e._v(" Planning your backup")]),e._v(" "),a("p",[e._v("The eXo Platform data consists of 2 parts:")]),e._v(" "),a("ul",[a("li",[e._v("data directories that can be backed up and restored using the OS utilities.")]),e._v(" "),a("li",[e._v("JCR, IDM and JPA datasources that can be backed up and restored using the DBMS tools.")])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("These two parts need to be backed up and restored consistently.Inconsistency may lead to failures and exceptions at the eXo Platform runtime. During the backup, you should stop eXo Platform to make sure no write-process is performing.")])]),e._v(" "),a("p",[e._v("You may back up periodically or on-demand, before an upgrade or a patch for instance. If you are planning to back up periodically, consider the following things:")]),e._v(" "),a("ul",[a("li",[e._v("How often the backup is performed? Remember that there is downtime during the backup.")]),e._v(" "),a("li",[e._v("How much disk space is used for backup storage? Less space, less archive.")]),e._v(" "),a("li",[e._v("Prepare for the tools that involve: copy (local and network), compress and decompress tools, SQL backup tools and automation.")])]),e._v(" "),a("p",[e._v("If your backup takes long time and occupies a big memory space, here are some tips:")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("The downtime will be much shorter if you have File System data and SQL data located on different hard drives, and back up them in parallel.")])]),e._v(" "),a("li",[a("p",[e._v("Try optimizing your database server to restore faster.")])]),e._v(" "),a("li",[a("p",[e._v("You do not need full-backup all the time. There are 2 backup options: "),a("em",[e._v("incremental")]),e._v(" and "),a("em",[e._v("differential")]),e._v(" that may lower the space. The backup approaches are explained "),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/Backup",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(". Linux "),a("a",{attrs:{href:"http://rsync.samba.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("rsync"),a("OutboundLink")],1),e._v(" and Windows backup utilities can perform incremental/differential backup. Any SQL Database server should support incremental backup. - Think of automation which can be used for your backup.")])])])]),e._v(" "),a("h2",{attrs:{id:"perform-backup-and-restore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#perform-backup-and-restore"}},[e._v("#")]),e._v(" Perform Backup and Restore")]),e._v(" "),a("p",[e._v("If you do not customize and configure eXo Platform, the whole data is located in one directory. So you just need to backup and restore the folder "),a("code",[e._v("$PLATFORM_TOMCAT_HOME/gatein/data")]),e._v(".")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("The above locations are the default ones, you may have different path to the data folder which is shared and accessible by your sever node(s).")])]),e._v(" "),a("p",[e._v("However it is not the case in production. As introduced in "),a("code",[e._v("Planning your backup")]),e._v(", the eXo Platform data consists of JCR File System data and JCR/IDM/JPA SQL datasources. The backup/restore does not require any specific tools. You just need to know the data location and use OS utilities to backup/ restore file system data and DBMS tools to backup/restore SQL databases.")]),e._v(" "),a("p",[e._v("The data folder contains these directories:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("files")]),e._v(": it contains "),a("code",[e._v("file storage")]),e._v(" data.")]),e._v(" "),a("li",[a("code",[e._v("jcr")]),e._v(": it contains jcr data i.e. indexes, values and swap (swap folder is not not mandatory to backup/restore).")]),e._v(" "),a("li",[a("code",[e._v("jta")]),e._v(": it contains transaction data and it is not mandatory to backup/restore.")])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("JCR Directory and JCR database must be consistent. Then you should stop eXo Platform, backup both before restarting. All nodes should be stopped if you are running the cluster mode.")])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("If you use eXo Wallet addon, the folder "),a("code",[e._v("$PLATFORM_TOMCAT_HOME/gatein/conf/codec")]),e._v(" must be backed up as well. If this folder content is lost, the access to admin wallet and other backed up wallets will be lost. The access to wallet applications can be compromised.")])]),e._v(" "),a("h3",{attrs:{id:"file-system-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-system-data"}},[e._v("#")]),e._v(" File System Data")]),e._v(" "),a("p",[e._v("You can check the data location in the customized configuration file: "),a("code",[e._v("$PLATFORM_TOMCAT_HOME/bin/setenv-customize")]),e._v(" ("),a("code",[e._v(".sh")]),e._v(" for Linux and "),a("code",[e._v(".bat")]),e._v("for Windows).")]),e._v(" "),a("p",[e._v("Open the file and find "),a("em",[e._v("EXO_DATA_DIR")]),e._v(". This variable indicates the folder you need to backup or restore. As explained above, "),a("em",[e._v("EXO_DATA_DIR")]),e._v(" takes by default the values cited in the top page but you can customize it.")]),e._v(" "),a("p",[e._v("You may disregard the background storage system (device and protocol) and let the OS take care of it. However, to make it efficiently, the background storage should be considered. There are working storage (that eXo Platform uses) and backup storage. Each of two can be on local drives, or a mount point of a network shared device. Each can be a "),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/Storage_area_network",target:"_blank",rel:"noopener noreferrer"}},[e._v("SAN"),a("OutboundLink")],1),e._v(" or a "),a("a",{attrs:{href:"http://en.wikipedia.org/wiki/Network-attached_storage",target:"_blank",rel:"noopener noreferrer"}},[e._v("NAS"),a("OutboundLink")],1),e._v(" storage. You should use different hard drives for working storage and backup storage, for safety, and conditionally for speed.")]),e._v(" "),a("h3",{attrs:{id:"jcr-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jcr-data"}},[e._v("#")]),e._v(" JCR Data")]),e._v(" "),a("p",[e._v("As said above, the whole JCR file system data is located in one root directory (EXO_DATA_DIR). However, there is a possibility that an element (a workspace for instance) is configured to be different. To handle such cases, look inside the file system data. There may be:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Index directory, which will be checked at the eXo Platform startup, and re-created if missing. In the cluster mode, the eXo Platform instances may share an index directory, or use their own directories.")])]),e._v(" "),a("li",[a("p",[e._v('Value directory (if existing) that is used to store the BLOB data. The BLOB data can be optionally stored in database and file system storage, and is defaulted to "true". You can override this in '),a("code",[e._v("exo.properties file")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[e._v("exo.jcr.storage.enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[e._v("true")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Swap directory, which is used as temporary memory space at runtime. This is not mandatory in backup and restore.")])])]),e._v(" "),a("p",[e._v("By default, all are located under "),a("code",[e._v("EXO_DATA_DIR")]),e._v(" and each workspace has its index, value and swap directories. Also, the portal default configurations may be changed or overwritten, however it is not recommended to do this. To see how it can happen, see "),a("code",[e._v("JCR Configuration")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"sql-databases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-databases"}},[e._v("#")]),e._v(" SQL Databases")]),e._v(" "),a("p",[e._v("Check your database configurations to see which databases are being used. The database configurations are described in "),a("code",[e._v("Configuring eXo Platform")]),e._v(" of the Database configuration section.")]),e._v(" "),a("p",[e._v("There should be three "),a("code",[e._v("datasources")]),e._v(": JCR, IDM and JPA.")]),e._v(" "),a("p",[e._v("You should backup and restore the whole database. If you want to backup and restore tables separately, make sure your backup parts are consistent.")]),e._v(" "),a("h2",{attrs:{id:"planning-your-backup-for-mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#planning-your-backup-for-mongodb"}},[e._v("#")]),e._v(" Planning your backup for MongoDB")]),e._v(" "),a("p",[e._v("You can use "),a("em",[e._v("mongodump")]),e._v(" command to back up your database, assume its name is "),a("em",[e._v("exochat")]),e._v(":")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Against a non-authentication MongoDB server:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("    mongodump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--db")]),e._v(" exochat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--out")]),e._v(" /path/to/store/the/backup\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Against a secured MongoDB server:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("    mongodump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--host")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--port")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--username")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--password")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--db")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("dbName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--out")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"{backup\\_folder}"')]),e._v("\n")])])])])])])}),[],!1,null,null,null);a.default=s.exports}}]);