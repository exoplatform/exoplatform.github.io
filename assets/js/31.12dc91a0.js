(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{382:function(t,a,e){"use strict";e.r(a);var s=e(14),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#database"}},[t._v("#")]),t._v(" Database")]),t._v(" "),a("blockquote",[a("p",[t._v("By default, eXo Platform uses HSQL and you do not need any configuration to make it work. Follow this chapter only when you need to use another RDBMS.\nAssuredly you can use MySQL or PostgreSQL Optimistically any SQL database that provides a JDBC compliant driver can be used.")]),t._v(" "),a("p",[t._v("In this chapter:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Creating databases")]),t._v(" You need to create databases. The tables are created automatically in Platform first startup.")]),t._v(" "),a("li",[a("code",[t._v("Configuring eXo Platform")]),t._v(" This section is a complete guide to configure eXo to use a RDBMS.")]),t._v(" "),a("li",[a("code",[t._v("Configuring Database in a docker install")]),t._v("  This section describes how to configure database in a docker container.")]),t._v(" "),a("li",[a("code",[t._v("Datasource JNDI name")]),t._v(" If for any reason you want to change JNDI name of the datasources, follow this section.")]),t._v(" "),a("li",[a("code",[t._v("File storage")]),t._v(" This section targets to describe the possible ways to store binary files in eXo Platform. It also makes comparison between them to allow administrators to choose the suitable file storage for their environment.")]),t._v(" "),a("li",[a("code",[t._v("Configuring eXo Chat database")]),t._v(" This section introduces the parameters to configure eXo Chat MongoDB database.")]),t._v(" "),a("li",[a("code",[t._v("Frequently asked questions")]),t._v(" This section especially targets to solve some possible issues.")])])]),t._v(" "),a("h2",{attrs:{id:"creating-databases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-databases"}},[t._v("#")]),t._v(" Creating databases")]),t._v(" "),a("p",[t._v("eXo Platform uses three datasources:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("IDM")]),t._v(": For Identity Management service.")]),t._v(" "),a("li",[a("strong",[t._v("JCR")]),t._v(": For Java Content Repository service.")]),t._v(" "),a("li",[a("strong",[t._v("JPA")]),t._v(": To store entities mapped by Hibernate.")])]),t._v(" "),a("p",[t._v("Create 3 databases, one for IDM, one for JCR and one for JPA, or you can use the same database for all of them. Leave the databases empty, the tables will be created automatically on Platform first startup.")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("If you do not need to support specific characters, it is recommended to use the character set "),a("code",[t._v("latin1")]),t._v(" and the collation    "),a("code",[t._v("latin1_general_cs")]),t._v(" (as eXo JCR is case sensitive). For example, in MySQL:")]),t._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" plf_jcr "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" latin1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" latin1_general_cs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("If you need to support specific characters, it is recommended to use the character set "),a("code",[t._v("utf8")]),t._v(" and the collation "),a("code",[t._v("utf8_bin")]),t._v(" (as eXo JCR is case sensitive). For example, in MySQL:")]),t._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" plf_jcr "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" utf8 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" utf8_bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("To avoid username/profile duplication, IDM schema should be case insensitive i.e it should use the collaction "),a("code",[t._v("latin1_swedish_ci")]),t._v(". For example, in MySQL:")]),t._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATABASE")]),t._v(" plf_idm "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARACTER")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" latin1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLLATE")]),t._v(" latin1_swedish_ci"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Grant a user the right to access the databases. The user should be allowed to access remotely from where eXo Platform is hosted.For example, in MySQL:")]),t._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("grant")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("all")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" ${dbname}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$username'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("@'$IP'")]),t._v(" identified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("$IP")]),t._v(" is your app server host name that accepts wildcard (for example, 192.168.1.% = all IPs on 192.168.1.x network).")]),t._v(" "),a("li",[a("code",[t._v("$username")]),t._v(" and "),a("code",[t._v("$password")]),t._v(" are credentials that eXo Platform will use to connect to the databases.")])])])]),t._v(" "),a("h2",{attrs:{id:"configuring-exo-platform"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-exo-platform"}},[t._v("#")]),t._v(" Configuring eXo Platform")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("By default, eXo Platform is connected to hsql database. This database could be used for testing purpose but it is not possible to use it in production environments.")])]),t._v(" "),a("p",[t._v("eXo Platform relies on the Tomcat application server to access databases. It uses three JNDI datasources:")]),t._v(" "),a("ul",[a("li",[t._v("IDM uses "),a("em",[t._v("exo-idm_portal")]),t._v(".")]),t._v(" "),a("li",[t._v("JCR uses "),a("em",[t._v("exo-jcr_portal")]),t._v(".")]),t._v(" "),a("li",[t._v("JPA uses "),a("em",[t._v("exo-jpa_portal")]),t._v(".")])]),t._v(" "),a("p",[t._v("eXo provides the ready-made and fine-tuned configuration so typically you just need to choose a sample and modify the connection url and the credentials.")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Configure the datasources.")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Edit "),a("code",[t._v("conf/server.xml")]),t._v(" to remove the default HSQL configuration:")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo IDM Datasource for portal --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-idm_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.hsqldb.jdbcDriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo JCR Datasource for portal --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-jcr_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.hsqldb.jdbcDriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo JPA Datasource for portal --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-jpa_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.hsqldb.jdbcDriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Add a new one. For MySQL as an example, you will just need to copy the sample in "),a("code",[t._v("conf/server-mysql.xml")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo IDM Datasource for portal --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-idm_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("javax.sql.DataSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.mysql.jdbc.Driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("jdbc:mysql://localhost:3306/plf?autoReconnect=true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo JCR Datasource for portal --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-jcr_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("javax.sql.DataSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.mysql.jdbc.Driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("jdbc:mysql://localhost:3306/plf?autoReconnect=true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- eXo JPA Datasource for portal --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Resource")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("exo-jpa_portal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("auth")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("javax.sql.DataSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("driverClassName")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.mysql.jdbc.Driver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("jdbc:mysql://localhost:3306/plf?autoReconnect=true"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&"}},[t._v("&amp;")]),t._v("characterEncoding=utf8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("Edit username, password, url (host, port and database name).Besides MySQL, if you are using Enterprise Edition, you will\nfind the samples for other RDBMSs in "),a("code",[t._v("conf/server-*.xml")]),t._v(".")])]),t._v(" "),a("li",[a("p",[t._v("Append this character encoding to the url in case your database character set is "),a("code",[t._v("utf8")]),t._v(". For example, in MySQL (this is different between RDBMSs):")])])]),t._v(" "),a("div",{staticClass:"language-TEXT extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('   url="jdbc:mysql://localhost:3306/plf?autoReconnect=true&amp;amp;characterEncoding=utf8"\n')])])])]),t._v(" "),a("li",[a("p",[t._v("Set the SQL Dialect if necessary. This step is not mandatory because the dialect is auto-detected in most cases. You only need to take care of it for some particular RDBMSs:")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("For JCR, only when you are using MySQL and database character set "),a("code",[t._v("utf8")]),t._v(", you need to edit "),a("code",[t._v("gatein/conf/exo.properties")]),t._v(" file to have:")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("   exo.jcr.datasource.dialect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("MySQL-UTF8")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("For IDM, eXo Platform detects automatically the dialect for RDBMSs listed "),a("a",{attrs:{href:"http://docs.jboss.org/hibernate/orm/4.1/manual/en-US/html_single/#configuration-optional-dialects",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(". Only when your RDBMS is "),a("strong",[t._v("not")]),t._v(" in the list, for example "),a("em",[t._v("Postgres Plus Advanced Server 9.2")]),t._v(", you will need to edit "),a("code",[t._v("gatein/conf/exo.properties")]),t._v(" file to have:")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("  hibernate.dialect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("org.hibernate.dialect.PostgresPlusDialect")]),t._v("\n")])])])])])]),t._v(" "),a("li",[a("p",[t._v("Download the JDBC driver for Java and install it to "),a("code",[t._v("$PLATFORM_TOMCAT_HOME/lib")]),t._v(".")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("Normally you can find out an appropriate driver for your JDK from your database vendor website. For example, for MySQL: "),a("a",{attrs:{href:"http://dev.mysql.com/downloads/connector/j/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://dev.mysql.com/downloads/connector/j/"),a("OutboundLink")],1),t._v(".")])]),t._v(" "),a("p",[t._v("eXo provides the database drivers in specific addons that you can install depending on the database that you will be using.\nTo install the addon of Mysql Java connector :")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./addon "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" exo-jdbc-driver-mysql\n")])])]),a("p",[t._v("To install the addon of Postgresql Java connector :")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./addon "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" exo-jdbc-driver-postgresql\n")])])]),a("h2",{attrs:{id:"configuring-database-for-a-docker-container"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-database-for-a-docker-container"}},[t._v("#")]),t._v(" Configuring database for a docker container")]),t._v(" "),a("p",[t._v("eXo Platform docker image supports both HSQL and MySQL databases. HSQL database is the default one for testing purposes. To move into production environment, it is highly recommended to connect the docker image to MySQL database.")]),t._v(" "),a("p",[t._v("For that purpose, you should specify some environment variables to the container startup command to make it work. The table below lists these needed variables:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Variable")]),t._v(" "),a("th",[t._v("Mandatory")]),t._v(" "),a("th",[t._v("Default value")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("EXO_DB_TYPE")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("hsqldb")]),t._v(" "),a("td",[t._v("The database type to be used, supports hsqldb (not for production) and mysql databases.")])]),t._v(" "),a("tr",[a("td",[t._v("EXO_DB_HOST")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("mysql")]),t._v(" "),a("td",[t._v("The host to connect to the database server.")])]),t._v(" "),a("tr",[a("td",[t._v("EXO_DB_PORT")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("3306")]),t._v(" "),a("td",[t._v("The port to connect to the database server.")])]),t._v(" "),a("tr",[a("td",[t._v("EXO_DB_NAME")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("exo")]),t._v(" "),a("td",[t._v("The name of the database schema to use.")])]),t._v(" "),a("tr",[a("td",[t._v("EXO_DB_USER")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("exo")]),t._v(" "),a("td",[t._v("The username to connect to the database.")])]),t._v(" "),a("tr",[a("td",[t._v("EXO_DB_PASSWORD")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("The password to connect to the database.")])])])]),t._v(" "),a("p",[t._v("An example of the execution command to use MySQL database for eXo Platform docker image:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXO_DB_TYPE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXO_DB_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql.server-hostname.org"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXO_DB_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"exo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXO_DB_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-secret-pw"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        exoplatform/exo-community\n")])])]),a("p",[t._v("For more details, you can look at this "),a("a",{attrs:{href:"https://hub.docker.com/r/exoplatform/exo-community/",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"file-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-storage"}},[t._v("#")]),t._v(" File Storage")]),t._v(" "),a("p",[t._v("In order to store binary files uploaded by users (such as attachments, documents or profile pictures) eXo Platform needs a file storage subsystem. There are two supported methods to perform file storage:")]),t._v(" "),a("ul",[a("li",[t._v("File System: files are stored in the server file system in a folder structure as regular files.")]),t._v(" "),a("li",[t._v("RDBMS: files are stored in the database as BLOBs.")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("You should choose either to store binary data in the database or through file system by setting the suitable value to the variable "),a("code",[t._v("exo.files.binaries.storage.type")]),t._v(". Choosing one file storage than the other depends on your data type and size.")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("Note that in case of using database as file storage, binary files are stored in the database table FILES_BINARY however in case of using file system storage, binary files are loaded from a folder of files. If you choose to store data through file system then you want to change to database or vice versa, note that you will lose data files because the source of binary files is different in the two cases. Consequently, you should choose the suitable file storage. if you absolutely need to migrate from RDBMS to File System or vice versa, you need to "),a("strong",[t._v("implement a migration tool allowing to maintain your binary files.")])])]),t._v(" "),a("h3",{attrs:{id:"file-system-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-system-storage"}},[t._v("#")]),t._v(" File System storage")]),t._v(" "),a("ul",[a("li",[t._v("The primary advantage of storing files in the file system is that it is easier to see the actual files.")]),t._v(" "),a("li",[t._v("Through file system, it is possible to backup and manipulate files separately of the database.")]),t._v(" "),a("li",[t._v("Files are stored off the database keeping it lighter.")])]),t._v(" "),a("h3",{attrs:{id:"rdbms-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rdbms-storage"}},[t._v("#")]),t._v(" RDBMS storage")]),t._v(" "),a("p",[t._v("Storing files in the database has many advantages such as:")]),t._v(" "),a("ul",[a("li",[t._v("The database backup will contain everything: It is easier for backup since only the database must be saved (and optionally the search indices). There is no need for a shared file system in cluster mode (database is shared in cluster mode).")]),t._v(" "),a("li",[t._v("The database can enforce more subtle controls on access to the files.")]),t._v(" "),a("li",[t._v("In case of changing files, the DBMS knows how to manage transactions.")])]),t._v(" "),a("h3",{attrs:{id:"comparing-file-system-and-rdbms-storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#comparing-file-system-and-rdbms-storage"}},[t._v("#")]),t._v(" Comparing file system and RDBMS storage")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Feature")]),t._v(" "),a("th",[t._v("RDBMS")]),t._v(" "),a("th",[t._v("File system")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Transaction support: This feature is needed in case of concurrent access to the same dataset.")]),t._v(" "),a("td",[t._v("A basic feature provided by all databases.")]),t._v(" "),a("td",[t._v("Most of file systems don't have this feature. Transactional NTFS(TxF), Sun ZFS, and Veritas VxFS, support this feature. With eXo Platform transaction is managed at application level.")])]),t._v(" "),a("tr",[a("td",[t._v("Fast indexing: by most of file systems. It helps fast retrieval of data.")]),t._v(" "),a("td",[t._v("Databases allow indexing based on any attribute or data-property (i.e SQL columns).")]),t._v(" "),a("td",[t._v("This is not offered")])]),t._v(" "),a("tr",[a("td",[t._v("Consistency check")]),t._v(" "),a("td",[t._v("It is provided by all databases.")]),t._v(" "),a("td",[t._v("File systems also support data consistency check.")])]),t._v(" "),a("tr",[a("td",[t._v("Clean unused data")]),t._v(" "),a("td",[t._v("Possible with database.")]),t._v(" "),a("td",[t._v("File system also ensure data cleanup.")])]),t._v(" "),a("tr",[a("td",[t._v("Clustering")]),t._v(" "),a("td",[t._v("Advanced databases offer clustering capabilities (such as Oracle and Mysql).")]),t._v(" "),a("td",[t._v("File systems still don't support this option (The only exceptions are Veritas CFS and GFS.")])]),t._v(" "),a("tr",[a("td",[t._v("Replication")]),t._v(" "),a("td",[t._v("It is a commodity with databases.")]),t._v(" "),a("td",[t._v("File systems provide replication feature but still need evolution.")])]),t._v(" "),a("tr",[a("td",[t._v("Relational View of Data")]),t._v(" "),a("td",[t._v("Databases offer easy means to relate stored data. It also offers a flexible query language (SQL) to retrieve the data.")]),t._v(" "),a("td",[t._v("File systems have little or no information about the data stored in the files because it stores files in a stream of bytes.")])])])]),t._v(" "),a("p",[t._v("::: note\nWhen using eXo Platform in cluster mode and choosing to use "),a("strong",[t._v("file system for binary files storage")]),t._v(", the files folder "),a("strong",[t._v("should be shared between all the cluster nodes")]),t._v(".\n:::")]),t._v(" "),a("h3",{attrs:{id:"file-storage-data-backup-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-storage-data-backup-requirements"}},[t._v("#")]),t._v(" File storage data backup requirements")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("To back up data, eXo Platform should be "),a("strong",[t._v("stopped")]),t._v(".")])]),t._v(" "),a("p",[t._v("In case of file system storage, to make the binary files backup, you need to:")]),t._v(" "),a("ul",[a("li",[t._v("Copy the folder of files.")]),t._v(" "),a("li",[t._v("Backup these 3 database tables: FILES_FILES, FILES_NAMESPACES, FILES_ORPHAN_FILES.")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("In case of using the database for file storage, the tables related to file storage are: FILES_BINARY, FILES_FILES, FILES_NAMESPACES and FILES_ORPHAN_FILES, but you should "),a("strong",[t._v("backup the whole database")]),t._v(" since there are links between these tables and other eXo Platform tables.")])]),t._v(" "),a("p",[t._v("For more details about data backup in general, you can take a look on the section "),a("code",[t._v("Backup and Restore>")])]),t._v(" "),a("h3",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),a("p",[t._v("Some parameters are configurable in"),a("code",[t._v("exo.properties")]),t._v(". More details could be found "),a("code",[t._v("File Storage Configuration")])]),t._v(" "),a("h2",{attrs:{id:"configuring-exo-chat-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-exo-chat-database"}},[t._v("#")]),t._v(" Configuring eXo Chat database")]),t._v(" "),a("ol",[a("li",[t._v("eXo Chat uses "),a("a",{attrs:{href:"http://docs.mongodb.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB database"),a("OutboundLink")],1),t._v(". You can install it via this "),a("a",{attrs:{href:"https://www.mongodb.com/download-center",target:"_blank",rel:"noopener noreferrer"}},[t._v("link"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("li",[t._v("Configure the database parameters in "),a("code",[t._v("chat.properties")]),t._v(" or "),a("code",[t._v("exo.properties")]),t._v(". The files are located in "),a("code",[t._v("$PLATFORM_TOMCAT_HOME/gatein/conf")])])]),t._v(" "),a("p",[t._v("The parameters to set are the following:")]),t._v(" "),a("ul",[a("li",[t._v("standaloneChatServer: This parameter accepts a boolean value : true for standalone mode, false for embedded mode.")]),t._v(" "),a("li",[t._v("dbServerType: Default value is mongo which is the value that should be used.")]),t._v(" "),a("li",[t._v("dbServerHost: The host of MongoDB database.")]),t._v(" "),a("li",[t._v("dbServerPort: The port with which you will connect to MongoDB.")]),t._v(" "),a("li",[t._v("dbServerHosts: The MongoDB nodes to connect to, as a comma-separated list of "),a("code",[t._v("<host:port>")]),t._v(" values. For example "),a("strong",[t._v("host1:27017,host2:27017,host3:27017")]),t._v(".")]),t._v(" "),a("li",[t._v("dbName: The name of the MongoDB database for eXo Chat.")]),t._v(" "),a("li",[t._v("dbAuthentication: Set to true if authentication is needed to access to MongoDB.")]),t._v(" "),a("li",[t._v("dbUser: The username with which you should connect of the previous value is set to true.")]),t._v(" "),a("li",[t._v("dbPassword: The password for MongoDB authentication, it should be modified for security reasons.")])]),t._v(" "),a("p",[t._v("Here is an example for the chat configuration file (the database configuration is in the section "),a("em",[t._v("MongoDB")]),t._v("):")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    ##########################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # MongoDB")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbServerHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("localhost")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbServerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("27017")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("chat")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("admin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    dbPassword")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("pass")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    ##########################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # Chat Server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    standaloneChatServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatPassPhrase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("chat")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatServerBase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("http://127.0.0.1:8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatServerUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/chatServer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatPortalPage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/portal/intranet/chat")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatCronNotifCleanup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("0 0 * * * ?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    teamAdminGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/platform/users")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatReadTotalJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("200")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    ############################")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    # Chat Client updates")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("    #")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatIntervalSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("60000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatTokenValidity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("60000")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    chatUploadFileSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("100")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("    request.timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("15000")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("The parameters "),a("code",[t._v("dbServerPort")]),t._v(" and "),a("code",[t._v("dbServerHost")]),t._v(" are deprecated and should be replaced by the parameter "),a("code",[t._v("dbServerHosts")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("For a quick setup, the Chat add-on by default connects to MongoDB at "),a("em",[t._v("localhost:27017")]),t._v(" without authentication, so no advanced setup is required if you install MongoDB in the same machine with Platform server.")]),t._v(" "),a("p",[t._v("If you secure MongoDB and allow remote connections, you have to configure the add-on, see "),a("code",[t._v("Secured MongoDB")])])]),t._v(" "),a("h2",{attrs:{id:"frequently-asked-questions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frequently-asked-questions"}},[t._v("#")]),t._v(" Frequently asked questions")]),t._v(" "),a("p",[a("strong",[t._v("Q:")]),t._v(" "),a("strong",[t._v("How to remove the idle MySQL connections?")])]),t._v(" "),a("p",[a("strong",[t._v("A:")]),t._v(" Some RDBMSs, like MySQL, close the idle connections after a period (8 hours on MySQL by default). Thus, a connection from the pool will be invalid and any application SQL command will fail, resulting in errors as below:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    org.hibernate.SessionException: Session is closed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n    at org.hibernate.impl.AbstractSessionImpl.errorIfClosed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AbstractSessionImpl.java:72"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    at org.hibernate.impl.SessionImpl.getTransaction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SessionImpl.java:1342"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("To avoid this, you can use DBCP to monitor the idle connections and drop them when they are invalid, with the "),a("strong",[t._v("testWhileIdle")]),t._v(", "),a("strong",[t._v("timeBetweenEvictionRunsMillis")]),t._v(", and "),a("strong",[t._v("validationQuery")]),t._v(" parameters.")]),t._v(" "),a("p",[t._v("The validation query is specific to your RDBMS. For example, on MySQL, you would use:")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v('testWhileIdle="true" timeBetweenEvictionRunsMillis="300000" validationQuery="SELECT 1"\n')])])]),a("ul",[a("li",[a("strong",[t._v("testWhileIdle")]),t._v(" activates the idle connections monitoring.")]),t._v(" "),a("li",[a("strong",[t._v("timeBetweenEvictionRunsMillis")]),t._v(" defines the time interval between two checks in milliseconds (5 minutes in the example).")]),t._v(" "),a("li",[a("strong",[t._v("validationQuery")]),t._v(" provides a simple SQL command to validate connection to the RDBMS.")])]),t._v(" "),a("p",[t._v("For more details, refer to the following:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://markmail.org/message/a3bszoyqbvi5qer4",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://markmail.org/message/a3bszoyqbvi5qer4"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://stackoverflow.com/questions/15949/javatomcat-dying-database-connection",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://stackoverflow.com/questions/15949/javatomcat-dying-database-connection"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://confluence.atlassian.com/display/JIRA/Surviving+Connection+Closures",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://confluence.atlassian.com/display/JIRA/Surviving+Connection+Closures"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);